<!DOCTYPE html>  
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Theramind ‚Äì Breathe</title>
  <link rel="icon" href="https://img.icons8.com/fluency/48/brain.png"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='responsive.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/tsparticles@3/tsparticles.bundle.min.js"></script>
  <style>
    :root{
      --accent:#4f6df5;
      --accent-dark:#3e53cc;
      --glass-light:rgba(255,255,255,0.55);
      --glass-dark:rgba(20,20,40,0.55);
      --card-light:rgba(255,255,255,0.12);
      --card-dark:rgba(44,44,62,0.85);
      --ok:#10b981;
      --warn:#f59e0b;
      --danger:#ef4444;

      --background: #ffffff;
      --foreground: #111111;
      --primary: #4f46e5;
      --accent2: #06b6d4;
      --sidebar-bg: rgba(255,255,255,0.85);
      --glass-blur: blur(16px) saturate(180%);
      --button-color: #ffffff;
    }
    body.dark-theme {
      --background: #0d0d0f;
      --foreground: #f0f0f0;
      --primary: #6366f1;
      --accent2: #67e8f9;
      --sidebar-bg: rgba(30,30,30,0.85);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:'Poppins',sans-serif;
      background: var(--bg-gradient);
      background-size:cover;
      background-attachment:fixed;
      transition: background 0.4s ease, color 0.3s ease;
      overflow-x:hidden;
    }
    body.light{
      --bg-gradient: linear-gradient(180deg, rgba(238,241,255,0.9), rgba(200,210,255,0.5)), url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1600&q=60') no-repeat center center / cover;
      color:#1e1e2f;
    }
    body.dark{
      --bg-gradient: linear-gradient(180deg, rgba(0,0,0,0.6), rgba(10,10,18,0.8)), url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1600&q=60') no-repeat center center / cover;
      color:#f0f0f0;
    }

    #tsparticles{position:fixed;inset:0;z-index:0}

    /* ===================== Navbar ===================== */
    header.tm-nav {
      display:flex;
      align-items:center;
      justify-content:space-between;
      height:75px;
      padding:0 2rem;
      background: var(--sidebar-bg);
      backdrop-filter: var(--glass-blur);
      box-shadow: 0 6px 25px rgba(0,0,0,0.15);
      position: sticky;
      top:0;
      z-index: 100;
    }
    .tm-brand {
      display:flex;
      align-items:center;
      gap:0.75rem;
      font-weight:700;
      font-size:1.4rem;
      color: var(--foreground);
      text-decoration:none;
    }
    .tm-brand img.brand-mark { height:36px; }
    .tm-navlinks {
      display:flex;
      gap:1.5rem;
      align-items:center;
      flex-wrap:wrap;
    }
    .tm-navlinks a {
      text-decoration:none;
      font-weight:600;
      color: var(--primary);
      position: relative;
      transition: color 0.3s;
    }
    .tm-navlinks a:hover { color: var(--accent2); }
    .tm-navlinks a.active::after {
      content:'';
      position:absolute;
      bottom:-6px;
      left:0;
      width:100%;
      height:3px;
      background: var(--primary);
      border-radius:4px;
    }
    .theme-toggle {
      cursor:pointer;
      font-size:0.9rem;
      background: linear-gradient(135deg,var(--primary),var(--accent2));
      padding:6px 10px;
      border-radius:6px;
      color: var(--button-color);
      transition:0.3s;
    }
    .theme-toggle:hover { opacity:0.85; }

    @media (max-width:768px){
      header.tm-nav {
        flex-direction:column;
        align-items:flex-start;
        height:auto;
        padding:1rem;
      }
      .tm-navlinks {
        flex-direction:column;
        align-items:flex-start;
        width:100%;
        gap:0.6rem;
        margin-top:0.5rem;
      }
      .theme-toggle {
        align-self:flex-start;
        margin-top:0.5rem;
      }
    }

    /* Card container */
    .breathe-container{
      max-width: 900px;
      margin: 80px auto 120px;
      padding: 32px 28px;
      border-radius: 24px;
      background: var(--card-light);
      backdrop-filter: blur(18px);
      box-shadow: 0 10px 50px rgba(0,0,0,0.25);
      position:relative; z-index:1;
    }
    body.dark .breathe-container{ background: var(--card-dark); }

    .breathe-header{display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:12px}
    .breathe-header h2{margin:0;font-size:1.8rem}
    .subtle{opacity:0.85}

    .stage{
      display:grid;
      place-items:center;
      margin: 24px auto;
      width:100%;
      min-height:340px;
      border-radius:20px;
      position:relative;
      overflow:hidden;
    }
    .orb{
      width: 220px; height: 220px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #a8b4ff, #6f8cfa 40%, #4757d6 70%, #2f2fa2 100%);
      box-shadow: 0 0 40px rgba(79,109,245,0.6), inset 0 0 40px rgba(255,255,255,0.25);
      transform: scale(1);
      transition: transform 1s ease;
    }
    .lotus-wrap{width:260px;height:260px}
    .lotus svg{width:100%;height:100%}
    .lotus .petal{transform-origin: 130px 130px; opacity:0.95}
    .lotus .center{filter: drop-shadow(0 0 8px rgba(255,255,255,0.5));}
    .waves{position:relative; width:280px;height:280px}
    .wave{position:absolute; inset:0; border-radius:50%; border:2px solid rgba(79,109,245,0.35); opacity:0.6; transform: scale(1); transition: transform 1s ease, opacity 1s ease}
    .wave:nth-child(2){inset:12px}
    .wave:nth-child(3){inset:24px}

    .panel{display:grid; grid-template-columns:1fr auto auto; gap:12px; align-items:center; margin-top: 6px;}
    #instruction{font-size:1.35rem}
    .chip{padding:8px 12px; border-radius:999px; background: rgba(79,109,245,0.1); color:inherit; font-weight:600; min-width:120px; text-align:center;}

    .controls{display:flex; flex-wrap:wrap; gap:10px; margin-top:18px}
    .btn, .select, .range{
      appearance:none; border:none; border-radius:12px; padding:12px 16px; font-weight:600; cursor:pointer;
      background: var(--accent); color:#fff; transition: transform .06s ease, background .2s ease;
    }
    .btn:active{ transform: translateY(1px) }
    .btn.secondary{ background: rgba(79,109,245,0.2); color: inherit }
    .btn.warn{ background: var(--warn); color:#000 }
    .btn.ok{ background: var(--ok); color:#000 }
    .btn.ghost{ background: rgba(0,0,0,0.12); color:inherit }
    .select{ background:#fff; color:#1e1e2f }
    body.dark .select{ background:#27273a; color:#f0f0f0 }
    .range{ background: transparent; padding:0 }
    input[type="range"]{ width:200px }

    #quote{margin-top:22px; font-style:italic; opacity:0.9}
    .toast{position:fixed; left:50%; bottom:22px; transform:translateX(-50%) translateY(20px);
      background:#1f2937; color:#fff; padding:12px 18px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,.25);
      opacity:0; pointer-events:none; transition: .28s ease; z-index:9999; font-weight:600;}
    .toast.show{ opacity:1; transform:translateX(-50%) translateY(0) }
  </style>
</head>
<body class="light">
  <div id="tsparticles"></div>

   <header class="tm-nav">
    <a class="tm-brand" href="/home">
      <img src="https://img.icons8.com/fluency/48/brain.png" alt="Theramind Logo" class="brand-mark">
      <span>Theramind</span>
    </a>
    <!-- Hamburger for mobile -->
    <div class="tm-hamburger" onclick="document.querySelector('.tm-nav').classList.toggle('show-links')">
        ‚ò∞
    </div>
    <nav class="tm-navlinks">
      <a href="/home">üè† Home</a>
      <a href="/index">üí¨ Chat</a>
      <a href="/journaling">üìì Journal</a>
      <a href="/breathing">ü´Å Breathing</a>
      <a href="/pick-a-peace">üìÉ Pick-a-Peace</a>
      <a href="/calm-corner">üßò Calm Corner</a>
      <a href="/ebooks">üìö E-Books</a>
      <a href="/history">üï∞Ô∏è History</a>
    </nav>
    <div class="theme-toggle" id="themeToggle">üåì Theme</div>
  </header>

  <!-- MAIN CARD -->
  <div class="breathe-container">
    <div class="breathe-header">
      <h2>Relax and Breathe</h2>
      <div class="badge">Shortcuts: <span class="kbd">Space</span> Start/Pause ¬∑ <span class="kbd">R</span> Reset</div>
    </div>

    <!-- Visual stage -->
    <div class="stage">
      <!-- Orb -->
      <div class="orb visual" id="visual-orb" aria-hidden="true"></div>

      <!-- Lotus -->
      <div class="lotus-wrap visual" id="visual-lotus" style="display:none" aria-hidden="true">
        <svg viewBox="0 0 260 260" class="lotus" role="img" aria-label="Lotus breathing visual">
          <!-- petals -->
          <g id="petals">
            <!-- 8 petals around -->
            <!-- We'll draw one petal path and rotate copies -->
            <!-- Base petal path -->
            <defs>
              <path id="petalPath" d="M130 35 C115 80, 115 120, 130 150 C145 120,145 80,130 35 Z" />
              <radialGradient id="petalGrad" cx="50%" cy="35%">
                <stop offset="0%" stop-color="#ffffff" stop-opacity="0.9"/>
                <stop offset="45%" stop-color="#a7c0ff" stop-opacity="0.9"/>
                <stop offset="100%" stop-color="#6f8cfa" stop-opacity="1"/>
              </radialGradient>
            </defs>
            <!-- clones rotated -->
            <use href="#petalPath" class="petal" fill="url(#petalGrad)" transform="rotate(0 130 130)"/>
            <use href="#petalPath" class="petal" fill="url(#petalGrad)" transform="rotate(45 130 130)"/>
            <use href="#petalPath" class="petal" fill="url(#petalGrad)" transform="rotate(90 130 130)"/>
            <use href="#petalPath" class="petal" fill="url(#petalGrad)" transform="rotate(135 130 130)"/>
            <use href="#petalPath" class="petal" fill="url(#petalGrad)" transform="rotate(180 130 130)"/>
            <use href="#petalPath" class="petal" fill="url(#petalGrad)" transform="rotate(225 130 130)"/>
            <use href="#petalPath" class="petal" fill="url(#petalGrad)" transform="rotate(270 130 130)"/>
            <use href="#petalPath" class="petal" fill="url(#petalGrad)" transform="rotate(315 130 130)"/>
          </g>
          <!-- center -->
          <circle class="center" cx="130" cy="130" r="22" fill="#cfe0ff" stroke="#7e9bff" stroke-width="3"/>
        </svg>
      </div>

      <!-- Waves -->
      <div class="waves visual" id="visual-waves" style="display:none" aria-hidden="true">
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
      </div>
    </div>

    <!-- Instruction + counters -->
    <div class="panel">
      <div id="instruction" class="subtle">Click ‚ÄúStart‚Äù to begin.</div>
      <div class="chip">Breaths: <span id="breath-count">0</span></div>
      <div class="chip">Mode: <span id="mode-label">Simple</span></div>
    </div>

    <!-- Controls -->
    <div class="controls" role="group" aria-label="Breathing controls">
      <button class="btn ok" id="start-btn">Start</button>
      <button class="btn warn" id="stop-btn">Pause</button>
      <button class="btn secondary" id="reset-btn">Reset Count</button>

      <select class="select" id="mode-select" title="Breathing Mode">
        <option value="simple">Simple (4‚Äì4)</option>
        <option value="box">Box (4‚Äì4‚Äì4‚Äì4)</option>
        <option value="478">4‚Äì7‚Äì8</option>
      </select>

      <select class="select" id="visual-select" title="Visual Style">
        <option value="orb">Orb</option>
        <option value="waves">Waves</option>
      </select>

      <label class="btn ghost" style="display:flex; align-items:center; gap:10px;">
        Pace <input type="range" id="pace" min="0.6" max="1.6" step="0.05" value="1"/>
      </label>

      <button class="btn" id="speech-btn">üîá Speech</button>
      <button class="btn" id="sound-btn">üîï Chime</button>
    </div>

    <div id="quote">‚ÄúFeelings come and go like clouds in a windy sky. Conscious breathing is my anchor.‚Äù</div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

<script>
/* =============== Theme, Particles, Quotes =============== */
  document.addEventListener("DOMContentLoaded", () => {
    const currentPath = window.location.pathname;
    document.querySelectorAll(".tm-navlinks a").forEach(link => {
      if (currentPath.includes(link.getAttribute("href"))) {
        link.classList.add("active");
      }
    });
    const themeToggle = document.getElementById("themeToggle");
    const prefersDark = localStorage.getItem("theme") === "dark";
    if (prefersDark) {
      document.body.classList.add("dark-theme","dark");
      themeToggle.textContent = "‚òÄÔ∏è Theme";
    } else {
      document.body.classList.remove("dark-theme");
      themeToggle.textContent = "üåô Theme";
    }
    themeToggle.addEventListener("click", () => {
      document.body.classList.toggle("dark-theme");
      document.body.classList.toggle("dark");
      const isDark = document.body.classList.contains("dark-theme");
      localStorage.setItem("theme", isDark ? "dark" : "light");
      themeToggle.textContent = isDark ? "‚òÄÔ∏è Theme" : "üåô Theme";
    });
  });

tsParticles.load("tsparticles", {
  fullScreen:false,
  particles:{
    number:{ value: 40 },
    color:{ value: "#aab8ff" },
    shape:{ type:"circle" },
    opacity:{ value: 0.18 },
    size:{ value: 3.5 },
    move:{ enable:true, speed: 0.6 }
  }
});

const quotes = [
  "‚ÄúFeelings come and go like clouds in a windy sky. Conscious breathing is my anchor.‚Äù ‚Äì Thich Nhat Hanh",
  "‚ÄúBreathe. Let go. And remind yourself that this very moment is the only one you know you have for sure.‚Äù ‚Äì Oprah Winfrey",
  "‚ÄúSometimes the most important thing in a whole day is the rest we take between two deep breaths.‚Äù ‚Äì Etty Hillesum",
  "‚ÄúInhale peace, exhale stress.‚Äù",
  "‚ÄúYour breath is a portable sanctuary.‚Äù",
  "‚ÄúConscious breathing is the best antidote to stress, anxiety, and depression.‚Äù ‚Äì Amit Ray",
  "‚ÄúReturn to your breath and return to yourself.‚Äù"
];
function showRandomQuote(){
  const q = quotes[Math.floor(Math.random()*quotes.length)];
  document.getElementById('quote').textContent = q;
}

/* =============== UI Elements =============== */
const instruction = document.getElementById('instruction');
const breathCounter = document.getElementById('breath-count');
const modeLabel = document.getElementById('mode-label');
const toast = document.getElementById('toast');
const startBtn = document.getElementById('start-btn');
const stopBtn = document.getElementById('stop-btn');
const resetBtn = document.getElementById('reset-btn');
const modeSelect = document.getElementById('mode-select');
const visualSelect = document.getElementById('visual-select');
const paceSlider = document.getElementById('pace');
const speechBtn = document.getElementById('speech-btn');
const soundBtn = document.getElementById('sound-btn');

const visualOrb = document.getElementById('visual-orb');
const visualLotus = document.getElementById('visual-lotus');
const visualWaves = document.getElementById('visual-waves');

/* =============== Toast (custom) =============== */
let toastTimer;
function showToast(msg){
  toast.textContent = msg;
  toast.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=>toast.classList.remove('show'), 2200);
}

/* =============== Modes & State =============== */
const modes = {
  simple: { name:'Simple', steps:["Inhale","Exhale"], durations:[4000,4000] },
  box:    { name:'Box',    steps:["Inhale","Hold","Exhale","Hold"], durations:[4000,4000,4000,4000] },
  478:    { name:'4‚Äì7‚Äì8',  steps:["Inhale","Hold","Exhale"], durations:[4000,7000,8000] }
};

let currentModeKey = 'simple';
let stepIndex = 0;
let cycleCount = 0;
let timerId = null;
let pace = 1.0;
let speechEnabled = false;
let soundEnabled = false;

/* =============== Audio (gentle chime) =============== */
let audioCtx;
function chime(){
  if(!soundEnabled) return;
  try{
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = 'sine';
    o.frequency.value = 660; // soft bell-like tone
    g.gain.value = 0.0001;
    o.connect(g).connect(audioCtx.destination);
    o.start();
    // quick attack/decay
    const now = audioCtx.currentTime;
    g.gain.exponentialRampToValueAtTime(0.15, now + 0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, now + 0.35);
    o.stop(now + 0.4);
  }catch(e){ /* no-op */ }
}

/* =============== Speech Guidance =============== */
function speak(text){
  if(!speechEnabled) return;
  const synth = window.speechSynthesis;
  const utter = new SpeechSynthesisUtterance(text);
  utter.pitch = 1; utter.rate = 0.85;
  const voice = synth.getVoices().find(v => v.name.includes("Google") || v.name.includes("Serena"));
  if(voice) utter.voice = voice;
  synth.cancel(); // prevent queue buildup
  synth.speak(utter);
}

/* =============== Visual Animations =============== */
function setVisual(style){
  // Hide all
  for(const el of document.querySelectorAll('.visual')) el.style.display='none';
  if(style==='orb') visualOrb.style.display='block';
  if(style==='lotus') visualLotus.style.display='block';
  if(style==='waves') visualWaves.style.display='block';
}

function animateVisual(step, duration){
  // Orb: scale in on Inhale, out on Exhale/Hold
  if(visualOrb.style.display!=='none'){
    const scale = step==="Inhale" ? 1.35 : 1.0;
    visualOrb.style.transition = `transform ${duration}ms ease`;
    visualOrb.style.transform = `scale(${scale})`;
  }
  // Lotus: bloom (scale up & mild rotate) on Inhale
  if(visualLotus.style.display!=='none'){
    const petals = document.querySelectorAll('.lotus .petal');
    const t = duration/1000;
    petals.forEach((p,i)=>{
      p.style.transition = `transform ${t}s ease, opacity ${t}s ease`;
      if(step==="Inhale"){
        p.style.transform = `rotate(${i*45} 130 130) translateY(-4px) scale(1.06)`;
        p.style.opacity = 1;
      }else{
        p.style.transform = `rotate(${i*45} 130 130) translateY(0) scale(1.0)`;
        p.style.opacity = 0.92;
      }
    });
  }
  // Waves: inner circles expand/contract subtly
  if(visualWaves.style.display!=='none'){
    const waves = visualWaves.querySelectorAll('.wave');
    waves.forEach((w,idx)=>{
      const base = 1 + idx*0.07;
      const scale = step==="Inhale" ? base + 0.25 : base;
      w.style.transform = `scale(${scale})`;
      w.style.opacity = step==="Inhale" ? 0.85 - idx*0.18 : 0.6 - idx*0.1;
      w.style.transition = `transform ${duration}ms ease, opacity ${duration}ms ease`;
    });
  }
}

/* =============== Engine =============== */
function updateModeDisplay(){
  modeLabel.textContent = modes[currentModeKey].name;
}

function nextStep(){
  const mode = modes[currentModeKey];
  const step = mode.steps[stepIndex];
  const duration = Math.round(mode.durations[stepIndex] * pace);

  instruction.textContent = step;
  speak(step);
  chime();
  animateVisual(step, duration);

  if(step==="Inhale"){ // increment breaths per inhale (1 per cycle)
    cycleCount++;
    breathCounter.textContent = cycleCount;
  }

  stepIndex = (stepIndex + 1) % mode.steps.length;
  timerId = setTimeout(nextStep, duration);
}

function start(){
  if(timerId) return;
  stepIndex = 0;
  nextStep();
  showToast("Breathing started");
}
function pause(){
  if(!timerId) return;
  clearTimeout(timerId);
  timerId = null;
  instruction.textContent = "Paused. Press Start to continue.";
  window.speechSynthesis.cancel();
  showToast("Paused");
}
function reset(){
  pause();
  cycleCount = 0;
  breathCounter.textContent = cycleCount;
  instruction.textContent = 'Click ‚ÄúStart‚Äù to begin.';
  // reset visuals
  visualOrb.style.transform = 'scale(1)';
  const petals = document.querySelectorAll('.lotus .petal');
  petals.forEach((p,i)=>{ p.style.transform = `rotate(${i*45} 130 130) scale(1)`; });
  const waves = visualWaves.querySelectorAll('.wave');
  waves.forEach((w,idx)=>{ w.style.transform = `scale(${1+idx*0.07})`; w.style.opacity = 0.6; });
  showToast("Counter reset");
}

/* =============== Event Wiring =============== */
startBtn.addEventListener('click', start);
stopBtn.addEventListener('click', pause);
resetBtn.addEventListener('click', reset);

modeSelect.addEventListener('change', ()=>{
  currentModeKey = modeSelect.value;
  updateModeDisplay();
  pause(); // apply immediately on resume
  showToast(`Mode: ${modes[currentModeKey].name}`);
});

visualSelect.addEventListener('change', ()=>{
  setVisual(visualSelect.value);
  showToast(`Visual: ${visualSelect.options[visualSelect.selectedIndex].text}`);
});

paceSlider.addEventListener('input', ()=>{
  pace = parseFloat(paceSlider.value);
  showToast(`Pace √ó${pace.toFixed(2)}`);
});

speechBtn.addEventListener('click', ()=>{
  speechEnabled = !speechEnabled;
  speechBtn.textContent = speechEnabled ? "üîä Speech" : "üîá Speech";
  showToast(speechEnabled ? "Speech enabled" : "Speech disabled");
});

soundBtn.addEventListener('click', ()=>{
  soundEnabled = !soundEnabled;
  soundBtn.textContent = soundEnabled ? "üîî Chime" : "üîï Chime";
  showToast(soundEnabled ? "Chime enabled" : "Chime disabled");
});

/* Keyboard: Space start/pause, R reset */
document.addEventListener('keydown', (e)=>{
  if(e.target && ['INPUT','SELECT','TEXTAREA'].includes(e.target.tagName)) return;
  if(e.code==='Space'){ e.preventDefault(); timerId ? pause() : start(); }
  if(e.key.toLowerCase()==='r'){ reset(); }
});

/* Init */
document.addEventListener('DOMContentLoaded', ()=>{
  // Persisted theme already applied
  setVisual('orb');
  updateModeDisplay();
  showRandomQuote();
  // seed waves base state
  const waves = visualWaves.querySelectorAll('.wave');
  waves.forEach((w,idx)=> w.style.transform = `scale(${1+idx*0.07})`);
});
// Hamburger toggle for mobile nav
  document.addEventListener("DOMContentLoaded", function() {
    const hamburger = document.querySelector('.tm-hamburger');
    const nav = document.querySelector('.tm-nav');

    if (hamburger && nav) {
      hamburger.addEventListener('click', function() {
        nav.classList.toggle('show-links');
      });
    }
  });
</script>
</body>
</html>

