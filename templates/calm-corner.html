<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Calm Corner | Theramind</title>
<link rel="icon" type="image/png" href="{{ url_for('static', filename='meditation.png') }}">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
/* =========================================================
   THEME VARIABLES
========================================================= */
:root {
  --background: #ffffff;
  --foreground: #111111;
  --primary: #4f46e5;
  --accent: #06b6d4;

  --sidebar-bg: rgba(255, 255, 255, 0.55);
  --glass-blur: blur(16px) saturate(180%);
  --button-color: #111;
}

body.dark-theme {
  --background: #0d0d0f;
  --foreground: #f0f0f0;
  --primary: #6366f1;
  --accent: #67e8f9;

  --sidebar-bg: rgba(30, 30, 30, 0.55);
  --button-color: #fff;
}

/* =========================================================
   GLOBAL RESET & BASE
========================================================= */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: "Poppins", sans-serif;
  background: var(--background);
  color: var(--foreground);
  min-height: 100vh;
  overflow-x: hidden;
  transition: background 0.3s ease, color 0.3s ease;
}

/* =========================================================
   NAVBAR
========================================================= */
.tm-nav {
  position: sticky;
  top: 0;
  z-index: 1000;

  height: 75px;
  padding: 0 2rem;

  display: flex;
  align-items: center;
  justify-content: space-between;

  background: var(--sidebar-bg);
  backdrop-filter: var(--glass-blur);
  box-shadow: 0 6px 25px rgba(0, 0, 0, 0.15);
}

.tm-brand {
  display: flex;
  align-items: center;
  gap: 0.75rem;

  font-size: 1.4rem;
  font-weight: 700;
  text-decoration: none;
  color: var(--foreground);
}

.tm-brand img {
  height: 36px;
}

.tm-navlinks {
  display: flex;
  align-items: center;
  gap: 1.5rem;
  flex-wrap: wrap;
}

.tm-navlinks a {
  position: relative;
  text-decoration: none;
  font-weight: 600;
  color: var(--primary);
  transition: color 0.3s ease;
}

.tm-navlinks a:hover {
  color: var(--accent);
}

.tm-navlinks a.active::after {
  content: "";
  position: absolute;
  left: 0;
  bottom: -6px;
  width: 100%;
  height: 3px;
  border-radius: 4px;
  background: var(--primary);
}

.theme-toggle {
  cursor: pointer;
  font-size: 0.9rem;
  padding: 6px 10px;
  border-radius: 6px;
  color: var(--button-color);
  background: linear-gradient(135deg, var(--primary), var(--accent));
  transition: opacity 0.3s ease;
}

.theme-toggle:hover {
  opacity: 0.85;
}

/* =========================================================
   WAVES BACKGROUND
========================================================= */
#waves {
  position: fixed;
  inset: 0;
  z-index: -1;
  overflow: hidden;
}

.wave {
  position: absolute;
  width: 200%;
  height: 100%;
  opacity: 0.4;
  background-repeat: repeat-x;
}

.wave1 {
  bottom: 0;
  animation: waveMove 30s linear infinite;
  background-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'><path fill='%234f6df5' fill-opacity='0.4' d='M0,64L40,90.7C80,117,160,171,240,197.3C320,224,400,224,480,186.7C560,149,640,75,720,80C800,85,880,171,960,202.7C1040,235,1120,213,1200,181.3C1280,149,1360,107,1400,85.3L1440,64L1440,320L0,320Z'/></svg>");
}

.wave2 {
  bottom: 10px;
  animation: waveMove 35s linear infinite;
  background-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'><path fill='%23a0c4ff' fill-opacity='0.3' d='M0,96L48,112C96,128,192,160,288,154.7C384,149,480,107,576,112C672,117,768,171,864,197.3C960,224,1056,224,1152,197.3C1248,171,1344,117,1392,90.7L1440,64L1440,320L0,320Z'/></svg>");
}

@keyframes waveMove {
  from { transform: translateX(0); }
  to   { transform: translateX(-50%); }
}

/* =========================================================
   MAIN CONTENT
========================================================= */
main {
  max-width: 1200px;
  margin: auto;
  padding: 40px 20px;
  text-align: center;
}

h1 {
  font-size: 2.4rem;
  margin-bottom: 10px;
}

.subtitle {
  margin-bottom: 30px;
  color: #555;
}

/* =========================================================
   TABS
========================================================= */
.tabs {
  display: flex;
  justify-content: center;
  gap: 16px;
  flex-wrap: wrap;
  margin-bottom: 30px;
}

.tab-button {
  padding: 10px 18px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 1rem;
  background: #e0e7ff;
  transition: all 0.3s ease;
}

.tab-button.active {
  background: var(--primary);
  color: #fff;
  font-weight: 600;
}

/* =========================================================
   AUDIO & AFFIRMATION CARDS
========================================================= */

.audio-section {
  display: none;
}

.audio-section.active {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 24px;
}

/* Cards */
.audio-card,
.affirm-card {
  width: 100%;
  max-width: 100%;
  padding: 20px;
  border-radius: 18px;
  backdrop-filter: var(--glass-blur);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  transition: transform 0.25s ease, box-shadow 0.25s ease;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* Audio card background */
.audio-card {
  background: rgba(255, 255, 255, 0.35);
}

body.dark-theme .audio-card {
  background: rgba(30, 30, 30, 0.35);
}

/* Hover effect */
.audio-card:hover,
.affirm-card:hover {
  transform: translateY(-6px);
  box-shadow: 0 14px 34px rgba(0, 0, 0, 0.25);
}

/* Fix long text overflow */
.audio-card h3,
.affirm-card {
  word-wrap: break-word;
}

/* =========================================================
   AFFIRMATION CARD STYLING
========================================================= */

.affirm-card {
  padding: 22px;
  border-radius: 18px;
  display: flex;
  flex-direction: column;
  gap: 14px;
  color: #111;
  box-shadow: 0 10px 30px rgba(0,0,0,0.12);
  transition: transform 0.25s ease, box-shadow 0.25s ease;
}

body.dark-theme .affirm-card {
  color: #111;
}

.affirm-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 18px 40px rgba(0,0,0,0.2);
}

.affirm-text {
  display: none;
  font-weight: 600;
  line-height: 1.6;
  padding-top: 8px;
}

/* Button Container */
.affirm-card button {
  border: none;
  padding: 8px 14px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
}

/* Reveal Button */
.reveal-btn {
  background: rgba(255,255,255,0.85);
  color: #333;
}

.reveal-btn:hover {
  background: white;
  transform: scale(1.05);
}

/* Hear Button */
.hear-btn {
  background: linear-gradient(135deg, var(--primary), var(--accent));
  color: white;
}

.hear-btn:hover {
  opacity: 0.9;
  transform: scale(1.05);
}

/* =========================================================
   MOBILE SIDEBAR
========================================================= */
.tm-sidebar {
  width: 260px;
  padding: 1.5rem 1.2rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;

  background: var(--sidebar-bg);
  backdrop-filter: var(--glass-blur);
  box-shadow: 4px 0 20px rgba(0, 0, 0, 0.2);
  border-radius: 0 14px 14px 0;
}

.sidebar-nav {
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
}

.sidebar-nav a {
  padding: 0.6rem 0.9rem;
  border-radius: 10px;
  text-decoration: none;
  font-weight: 600;
  color: var(--foreground);
}

.sidebar-nav a.active {
  background: linear-gradient(135deg, var(--primary), var(--accent));
  color: #fff;
}

.icon-btn {
  padding: 0.5rem 0.7rem;
  font-size: 1.2rem;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  color: var(--button-color);
  background: linear-gradient(135deg, var(--primary), var(--accent));
}
.affirm-text {
  display: none;
  margin-top: 12px;
  font-weight: 600;
  line-height: 1.5;
}


.mobile-only {
  display: none;
}

/* =========================================================
   RESPONSIVE BEHAVIOR
========================================================= */
@media (max-width: 1024px) {
  .mobile-only { display: inline-flex; }
  .tm-navlinks { display: none !important; }

  .tm-sidebar {
    position: fixed;
    top: 75px;
    left: 0;
    height: calc(100dvh - 75px);
    transform: translateX(-100%);
    z-index: 200;
  }

  .tm-sidebar.show {
    transform: translateX(0);
  }

  body.sidebar-open {
    overflow: hidden;
  }
}

@media (min-width: 1025px) {
  .tm-sidebar {
    display: none !important;
  }
}

/* =========================================================
   SMALL SCREENS
========================================================= */
@media (max-width: 480px) {
  h1 { font-size: 1.6rem; }
  .subtitle { font-size: 0.9rem; }
}

@media (max-width: 360px) {
  .wave { opacity: 0.25; }
}
</style>

</head>
<body>

<div id="waves">
  <div class="wave wave1"></div>
  <div class="wave wave2"></div>
</div>

<header class="tm-nav">
  <a class="tm-brand" href="/home">
    <img src="https://img.icons8.com/fluency/48/brain.png" alt="Theramind Logo">
    <span>Theramind</span>
  </a>
  
  <nav class="tm-navlinks">
    <a href="/">üè† Home</a>
    <a href="/index">üí¨ Chat</a>
    <a href="/journaling">üìì Journal</a>
    <a href="/breathing">ü´Å Breathing</a>
    <a href="/pick-a-peace">üìÉ Pick-a-Peace</a>
    <a href="/calm-corner" class="active">üßò Calm Corner</a>
    <a href="/ebooks">üìö E-Books</a>
    <a href="/history">üï∞Ô∏è History</a>
  </nav>
  <div class="theme-toggle" id="themeToggle">üåô Theme</div>
  <button
  id="sidebarToggle"
  class="icon-btn mobile-only"
  aria-label="Toggle sidebar"
  aria-expanded="false"
>
  ‚ò∞
</button>
</header>
<aside id="sidebar" class="tm-sidebar" aria-label="Sidebar Navigation">
  <nav class="sidebar-nav mobile-only">
    <a href="/">üè† Home</a>
    <a href="/index">üí¨ Chat</a>
    <a href="/journaling">üìì Journal</a>
    <a href="/breathing">ü´Å Breathing</a>
    <a href="/pick-a-peace">üìÉ Pick-a-Peace</a>
    <a href="/calm-corner" class="active">üßò Calm Corner</a>
    <a href="/ebooks">üìö E-Books</a>
    <a href="/history">üï∞Ô∏è History</a>
  </nav>
</aside>

<main>
  <h1>Find Your Calm</h1>
  <p class="subtitle">Relax, breathe, and let go with soothing sounds, music, and affirmations.</p>

  <div class="tabs" role="tablist">
    <button class="tab-button active" role="tab" aria-selected="true" onclick="switchTab('nature',this)">üå≥ Nature</button>
    <button class="tab-button" role="tab" aria-selected="false" onclick="switchTab('music',this)">üé∂ Music</button>
    <button class="tab-button" role="tab" aria-selected="false" onclick="switchTab('affirm',this)">‚ú® Affirmations</button>
  </div>

  <div id="nature" class="audio-section active"></div>
  <div id="music" class="audio-section"></div>
  <div id="affirm" class="audio-section"></div>
</main>

<script>
// === Audio & Affirmation Data ===
const sourcesNature = [
  {
    title: "Ocean Waves",
    url: "https://commons.wikimedia.org/wiki/Special:FilePath/Oceanwavescrushing.ogg",
    format: "OGG"
  },
  {
    title: "Rain & Thunder",
    url: "https://commons.wikimedia.org/wiki/Special:FilePath/Rain%20and%20thunder.ogg",
    format: "OGG"
  },
  {
    title: "Forest Birds",
    url: "https://commons.wikimedia.org/wiki/Special:FilePath/Birds%20forest.ogg",
    format: "OGG"
  },

  /* Reusing proven sources for stability */
  {
    title: "Gentle Ocean",
    url: "https://commons.wikimedia.org/wiki/Special:FilePath/Oceanwavescrushing.ogg",
    format: "OGG"
  },
  {
    title: "Deep Rainfall",
    url: "https://commons.wikimedia.org/wiki/Special:FilePath/Rain%20and%20thunder.ogg",
    format: "OGG"
  },
  {
    title: "Morning Birds",
    url: "https://commons.wikimedia.org/wiki/Special:FilePath/Birds%20forest.ogg",
    format: "OGG"
  },
  {
    title: "Calm Coast",
    url: "https://commons.wikimedia.org/wiki/Special:FilePath/Oceanwavescrushing.ogg",
    format: "OGG"
  },
  {
    title: "Soft Rain",
    url: "https://commons.wikimedia.org/wiki/Special:FilePath/Rain%20and%20thunder.ogg",
    format: "OGG"
  },
  {
    title: "Forest Ambience",
    url: "https://commons.wikimedia.org/wiki/Special:FilePath/Birds%20forest.ogg",
    format: "OGG"
  },
  {
    title: "Birds & Breeze",
    url: "https://commons.wikimedia.org/wiki/Special:FilePath/Birds%20forest.ogg",
    format: "OGG"
  }
];

const sourcesMusic = [
  {title:"Calm Piano", url:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3", format:"MP3"},
  {title:"Relaxing Guitar", url:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3", format:"MP3"},
  {title:"Soothing Strings", url:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3", format:"MP3"},
  {title:"Meditation Tune", url:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3", format:"MP3"},
  {title:"Ambient Waves", url:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3", format:"MP3"},
  {title:"Deep Focus", url:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3", format:"MP3"},
  {title:"Peaceful Night", url:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-7.mp3", format:"MP3"},
  {title:"Morning Dew", url:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3", format:"MP3"},
  {title:"Gentle Breeze", url:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-9.mp3", format:"MP3"},
  {title:"Serenity", url:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3", format:"MP3"}
];
const affirmations = [
  "I am calm and relaxed.","I am at peace with myself.","I release tension from my body.","I breathe deeply and slowly.","I am focused and centered.",
  "I am surrounded by positive energy.","I radiate love and joy.","I trust myself completely.","I am confident and strong.","I am resilient and adaptable.",
  "My mind is clear and peaceful.","I am grateful for today.","I am open to new opportunities.","I am full of positive thoughts.","I am free from worry and fear.",
  "I am healthy and strong.","I choose happiness and joy.","I forgive myself and others.","I am mindful and present.","I am patient and compassionate.",
  "I am creative and inspired.","I attract positivity into my life.","I am calm in stressful situations.","I am balanced and harmonious.","I release negative thoughts.",
  "I am courageous and bold.","I trust the journey of life.","I am successful in my endeavors.","I am worthy of love and respect.","I am kind and gentle.",
  "I am full of energy and vitality.","I am aligned with my purpose.","I am confident in my abilities.","I am loving and lovable.","I am calm amidst chaos.",
  "I am grateful for my blessings.","I am connected to my inner self.","I am motivated and determined.","I am peaceful and serene.","I am optimistic about the future.",
  "I am capable of achieving my goals.","I am free from doubt and fear.","I am mindful of my actions.","I am confident in making decisions.","I am present in every moment.",
  "I am joyful and content.","I am in harmony with the universe.","I am a beacon of positivity.","I am thankful for life.","I am at peace with my past."
];

const cardColors = [
  "linear-gradient(135deg,#a0c4ff,#bdb2ff)",
  "linear-gradient(135deg,#caffbf,#9bf6ff)",
  "linear-gradient(135deg,#ffd6a5,#ffadad)",
  "linear-gradient(135deg,#fdffb6,#caffbf)"
];

let currentAudio=null;
const allAudioElements={};

function preloadAudio(sources, sectionName){
  allAudioElements[sectionName]=[];
  sources.forEach(item=>{
    const audio=document.createElement('audio');
    audio.src=item.url;
    audio.preload='auto';
    audio.onplay=()=>{if(currentAudio && currentAudio!==audio) currentAudio.pause(); currentAudio=audio;};
    allAudioElements[sectionName].push({audio,title:item.title,format:item.format,url:item.url});
  });
}

preloadAudio(sourcesNature,'nature');
preloadAudio(sourcesMusic,'music');

function populateAudio(sectionId){
  const section=document.getElementById(sectionId);
  section.innerHTML='';
  const canPlayOgg=document.createElement('audio').canPlayType('audio/ogg');
  const items=allAudioElements[sectionId]||[];
  items.forEach(item=>{
    const card=document.createElement('div'); card.className='audio-card';
    const title=document.createElement('h3'); title.innerText=item.title;
    const badge=document.createElement('div'); badge.className='badge'; badge.innerText=`Format: ${item.format}`;
    const audio=item.audio; audio.controls=true;
    const download=document.createElement('a'); download.href=item.url; download.download=''; download.className='download-link'; download.innerText='üì• Download';
    card.append(title,badge,audio,download);
    if(item.format==='OGG' && !canPlayOgg){
      const note=document.createElement('div'); note.className='compat';
      note.innerText="If playback doesn't start, tap Download (some browsers don't play .ogg inline).";
      card.appendChild(note);
    }
    section.appendChild(card);
  });
}

function populateAffirmations(){
  const section = document.getElementById('affirm');
  section.innerHTML = '';

  affirmations.forEach((text, i) => {
    const card = document.createElement('div');
    card.className = 'affirm-card';
    card.style.background = cardColors[i % cardColors.length];

    const affirmText = document.createElement('div');
    affirmText.className = 'affirm-text';
    affirmText.textContent = text;

    const revealBtn = document.createElement('button');
    revealBtn.className = 'reveal-btn';
    revealBtn.textContent = 'Reveal';
    revealBtn.setAttribute('aria-expanded', 'false');

    const hearBtn = document.createElement('button');
    hearBtn.className = 'hear-btn';
    hearBtn.textContent = 'Hear';

    revealBtn.onclick = () => {
      const isVisible = affirmText.style.display === 'block';
      affirmText.style.display = isVisible ? 'none' : 'block';
      revealBtn.textContent = isVisible ? 'Reveal' : 'Hide';
      revealBtn.setAttribute('aria-expanded', String(!isVisible));
    };

    hearBtn.onclick = () => speak(text);

    card.append(revealBtn, hearBtn, affirmText);
    section.appendChild(card);
  });
}


function switchTab(tabId, btn){
  document.querySelectorAll('.audio-section').forEach(s=>s.classList.remove('active'));
  document.getElementById(tabId).classList.add('active');
  document.querySelectorAll('.tab-button').forEach(b=>{b.classList.remove('active'); b.setAttribute('aria-selected','false');});
  btn.classList.add('active'); btn.setAttribute('aria-selected','true');
  if(tabId==='nature') populateAudio('nature');
  if(tabId==='music') populateAudio('music');
  if(tabId==='affirm') populateAffirmations();
}

function speak(text) {
  if (!("speechSynthesis" in window)) return;

  window.speechSynthesis.cancel();

  const utterance = new SpeechSynthesisUtterance(text);
  utterance.rate = 0.92;     // slower = calmer
  utterance.pitch = 1.15;    // more human
  utterance.volume = 1;

  const voices = window.speechSynthesis.getVoices();

  // Prefer female, English, human-sounding voices
  const preferredVoice =
    voices.find(v => v.name.includes("Samantha")) ||   // iOS
    voices.find(v => v.name.includes("Google") && v.name.includes("Female")) || // Chrome
    voices.find(v => v.lang.startsWith("en") && v.name.toLowerCase().includes("female")) ||
    voices.find(v => v.lang.startsWith("en"));

  if (preferredVoice) utterance.voice = preferredVoice;

  window.speechSynthesis.speak(utterance);
}

// Ensure voices are loaded
window.speechSynthesis.onvoiceschanged = () => {};

// =================== Navbar & Theme ===================
document.addEventListener("DOMContentLoaded", ()=>{
    document.querySelectorAll(".tm-navlinks a").forEach(link=>{
  if(link.getAttribute("href") === window.location.pathname){
    link.classList.add("active");
  }
});


  // Theme toggle
  const themeToggle=document.getElementById("themeToggle");
  const darkStored=localStorage.getItem("theme")==='dark';
  if(darkStored) document.body.classList.add("dark-theme");
  themeToggle.textContent=darkStored?"‚òÄÔ∏è Theme":"üåô Theme";
  themeToggle.addEventListener("click",()=>{
    document.body.classList.toggle("dark-theme");
    const isDark=document.body.classList.contains("dark-theme");
    localStorage.setItem("theme",isDark?"dark":"light");
    themeToggle.textContent=isDark?"‚òÄÔ∏è Theme":"üåô Theme";
  });


  // Initialize first tab
  switchTab('nature',document.querySelector('.tab-button.active'));
});
const sidebar = document.getElementById("sidebar");
const sidebarToggle = document.getElementById("sidebarToggle");

sidebarToggle?.addEventListener("click", () => {
  sidebar.classList.toggle("show");
  document.body.classList.toggle("sidebar-open");

  sidebarToggle.setAttribute(
    "aria-expanded",
    sidebar.classList.contains("show")
  );
});

sidebar?.querySelectorAll("a").forEach(link => {
  link.addEventListener("click", () => {
    sidebar.classList.remove("show");
    document.body.classList.remove("sidebar-open");
    sidebarToggle.setAttribute("aria-expanded", "false");
  });
});

</script>

</body>
</html>

