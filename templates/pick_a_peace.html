<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pick-a-Peace | Theramind</title>
<link rel="icon" href="https://img.icons8.com/fluency/48/gift.png" type="image/png" />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />

<style>
/* ===================== Theme Variables ===================== */
:root {
  --background: #ffffff;
  --foreground: #111111;
  --primary: #4f46e5;
  --accent: #06b6d4;
  --sidebar-bg: rgba(255,255,255,0.55);
  --glass-blur: blur(16px) saturate(180%);
  --button-color: #111;
  --happy: #ffe44c;
  --sad: #8ac0f2;
  --angry: #ff5e5e;
  --calm: #90ee90;
}
body.dark-theme {
  --background: #0d0d0f;
  --foreground: #f0f0f0;
  --primary: #6366f1;
  --accent: #67e8f9;
  --sidebar-bg: rgba(30,30,30,0.55);
  --button-color: #fff;
}

/* ===================== Global ===================== */
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: 'Poppins', sans-serif;
  background: var(--background);
  color: var(--foreground);
  min-height:100vh;
  overflow-x:hidden;
  transition: background 0.3s, color 0.3s;
}

/* ===================== Navbar ===================== */
.tm-nav {
  display:flex;
  align-items:center;
  justify-content:space-between;
  height:75px;
  padding:0 2rem;
  background: var(--sidebar-bg);
  backdrop-filter: var(--glass-blur);
  box-shadow: 0 6px 25px rgba(0,0,0,0.15);
  position: sticky;
  top:0;
  z-index:1000;
}
.tm-brand {
  display:flex;
  align-items:center;
  gap:0.75rem;
  font-weight:700;
  font-size:1.4rem;
  color: var(--foreground);
  text-decoration:none;
}
.tm-brand img { height:36px; }
.tm-navlinks {
  display:flex;
  gap:1.5rem;
  align-items:center;
  flex-wrap:wrap;
}
.tm-navlinks a {
  text-decoration:none;
  font-weight:600;
  color: var(--primary);
  position: relative;
  transition: color 0.3s;
}
.tm-navlinks a:hover { color: var(--accent); }
.tm-navlinks a.active::after {
  content:''; position:absolute; bottom:-6px; left:0; width:100%; height:3px;
  background: var(--primary); border-radius:4px;
}
.theme-toggle {
  cursor:pointer;
  font-size:0.9rem;
  background: linear-gradient(135deg,var(--primary),var(--accent));
  padding:6px 10px;
  border-radius:6px;
  color: var(--button-color);
  transition:0.3s;
}
.theme-toggle:hover { opacity:0.85; }
.tm-hamburger { display:none; font-size:1.5rem; cursor:pointer; margin-top:0.5rem; }

/* ===================== Pick-a-Peace Bowl ===================== */
#particles-js { position: fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events:none; }
main {
  flex:1;
  padding:40px 20px;
  display:flex;
  flex-direction:column;
  align-items:center;
  position: relative;
  z-index:1;
}
h1 { font-size:2.8rem; font-weight:600; margin-bottom:10px; z-index:2; }
.subtitle { font-size:1.15rem; color: #666; margin-bottom:30px; z-index:2; }

.bowl-container {
  position:relative;
  width:100%;
  max-width:1000px;
  height:420px;
  background: radial-gradient(circle at 50% 40%, #ffffffa0, #c7d2fe);
  border-radius: 50% / 35%;
  border: 5px solid #ffffff88;
  box-shadow: inset 0 8px 25px rgba(0,0,0,0.15);
  overflow:hidden;
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  align-items:center;
  padding:30px;
  gap:16px;
  transition: transform 0.4s ease;
  z-index:2;
}
.bowl-container.shake { transform: rotate(2deg); }

.chit {
  width:70px; height:40px;
  border-radius:6px;
  box-shadow:0 4px 10px rgba(0,0,0,0.25);
  cursor:pointer;
  transition: transform 0.25s ease, box-shadow 0.25s ease;
  display:flex; justify-content:center; align-items:center;
  font-size:0.8rem; font-weight:600; color:#222;
  transform: rotate(calc(-15deg + 30deg * var(--rand, 0.5)));
}
.chit:hover { transform: scale(1.15) rotate(0deg); z-index:3; box-shadow:0 6px 14px rgba(0,0,0,0.35); }

/* ===================== Popup ===================== */
.popup {
  position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.8);
  background: var(--sidebar-bg); backdrop-filter: var(--glass-blur);
  padding: 25px 30px; border-radius: 16px;
  box-shadow: 0 12px 40px rgba(0,0,0,0.25);
  text-align:center; font-size:1.15rem; z-index:999;
  animation: popin 0.3s ease forwards;
  max-width:400px; color:var(--foreground);
}
.popup p { margin-bottom:15px; line-height:1.4; }
.popup .close-btn { position:absolute; top:10px; right:16px; font-size:22px; cursor:pointer; }
.popup button { margin-top:10px; padding:8px 18px; border:none; border-radius:8px; background: var(--primary); color:white; font-weight:600; cursor:pointer; }
@keyframes popin { to { transform: translate(-50%, -50%) scale(1); } }

/* ===================== Buttons & Legend ===================== */
.shuffle-btn, .saved-btn {
  margin:25px 10px 0; padding:12px 26px; font-size:1rem;
  background: var(--primary); color:white; border:none;
  border-radius:12px; cursor:pointer; z-index:2;
}

.legend { display:flex; gap:24px; margin-top:16px; flex-wrap:wrap; justify-content:center; z-index:2; }
.legend-item { display:flex; align-items:center; gap:8px; font-size:0.9rem; }
.legend-item span { width:18px; height:18px; border-radius:50%; display:inline-block; }

/* ===================== Saved Panel ===================== */
.saved-panel {
  position: fixed; top:50%; left:50%; transform:translate(-50%, -50%) scale(0.8);
  background: var(--sidebar-bg); border-radius:14px; padding:20px;
  box-shadow:0 8px 28px rgba(0,0,0,0.25);
  width:350px; max-height:60vh; overflow-y:auto; z-index:999; display:none;
  color:var(--foreground); backdrop-filter:var(--glass-blur);
}
.saved-panel.active { display:block; animation:popin 0.3s ease forwards; }
.saved-item { background:#f3f3f3; padding:8px 10px; border-radius:8px; margin-bottom:10px; font-size:0.9rem; position:relative; }
.saved-item button { position:absolute; right:8px; top:6px; background:none; border:none; cursor:pointer; font-size:14px; }

/* ===================== Responsive ===================== */
@media (max-width:768px){
  main { padding:30px 16px; }
  .bowl-container { height:280px; gap:10px; }
  .chit { width:55px; height:32px; font-size:0.65rem; }

  .tm-nav { flex-direction:column; align-items:flex-start; height:auto; padding:1rem; }
  .tm-navlinks { flex-direction:column; align-items:flex-start; width:100%; display:none; margin-top:0.5rem; gap:0.6rem; }
  .tm-navlinks.show-links { display:flex; }
  .theme-toggle { align-self:flex-start; margin-top:0.5rem; }
  .tm-hamburger { display:block; }

  /* ‚úÖ Moved here so it only applies on mobile */
  .tm-navlinks a { width: 100%; padding: 6px 0; }

  .shuffle-btn, .saved-btn { width:100%; margin-top:12px; }
}

@media (max-width:480px){
  .bowl-container { height:220px; padding:12px; }
  .chit { width:50px; height:28px; font-size:0.6rem; }
  h1 { font-size:1.6rem; }
  .subtitle { font-size:0.85rem; }
  .saved-panel { width:90%; max-height:70vh; }
}

@media (max-width:360px){
  .bowl-container { height:180px; padding:8px; }
  .chit { width:45px; height:25px; font-size:0.55rem; }
  h1 { font-size:1.45rem; }
  .subtitle { font-size:0.8rem; }
  .saved-panel { padding:15px; }
}

/* Popup scaling for mobile */
.popup { width: 90%; max-width: 350px; }

</style>

</head>

<body>
<header class="tm-nav">
  <a class="tm-brand" href="/home">
    <img src="https://img.icons8.com/fluency/48/brain.png" alt="Theramind Logo">
    <span>Theramind</span>
  </a>
  <div class="tm-hamburger">‚ò∞</div>
  <nav class="tm-navlinks">
    <a href="/">üè† Home</a>
    <a href="/index">üí¨ Chat</a>
    <a href="/journaling">üìì Journal</a>
    <a href="/breathing">ü´Å Breathing</a>
    <a href="/pick-a-peace" class="active">üìÉ Pick-a-Peace</a>
    <a href="/calm-corner">üßò Calm Corner</a>
    <a href="/ebooks">üìö E-Books</a>
    <a href="/history">üï∞Ô∏è History</a>
  </nav>
  <div class="theme-toggle" id="themeToggle">üåì Theme</div>
</header>

<div id="particles-js"></div>

<main>
  <h1>Pick-a-Peace</h1>
  <p class="subtitle">Pick a chit from the bowl and reveal a thoughtful quote.</p>
  <div class="bowl-container" id="bowl"></div>
  <button class="shuffle-btn" onclick="shuffleChits(this)">üîÑ Shuffle Chits</button>
  <button class="saved-btn" onclick="toggleSaved()">üìå Saved Quotes</button>
  <div class="legend">
    <div class="legend-item"><span style="background: var(--happy);"></span> Happy</div>
    <div class="legend-item"><span style="background: var(--sad);"></span> Sad</div>
    <div class="legend-item"><span style="background: var(--angry);"></span> Angry</div>
    <div class="legend-item"><span style="background: var(--calm);"></span> Calm</div>
  </div>
</main>

<div class="saved-panel" id="savedPanel">
  <h3>Saved Quotes</h3>
  <div id="savedList"></div>
  <button onclick="toggleSaved()">Close</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script>
// Particles.js
particlesJS("particles-js", {
  particles: {
    number: { value: 100, density: { enable: true, value_area: 800 } },
    color: { value: ["#6c63ff","#4f46e5","#67e8f9"] },
    shape: { type: "circle" },
    opacity: { value: 0.7, random: true, anim: { enable: true, speed: 1, opacity_min: 0.05, sync: false } },
    size: { value: 5, random: true, anim: { enable: true, speed: 2, size_min: 1, sync: false } },
    move: { enable: true, speed: 0.8, direction: "none", random: true, straight: false, out_mode: "out", bounce: false },
    line_linked: { enable: false }
  },
  interactivity: {
    detect_on: "canvas",
    events: { onhover: { enable: true, mode: "repulse" }, onclick: { enable: true, mode: "push" }, resize: true },
    modes: { repulse: { distance: 80, duration: 0.4 }, push: { particles_nb: 4 } }
  },
  retina_detect: true
});

// Theme toggle
const themeToggle = document.getElementById("themeToggle");
if(localStorage.getItem("theme") === "dark") {
  document.body.classList.add("dark-theme");
  themeToggle.textContent = "‚òÄÔ∏è Theme";
} else themeToggle.textContent = "üåô Theme";
themeToggle.addEventListener("click", () => {
  document.body.classList.toggle("dark-theme");
  const isDark = document.body.classList.contains("dark-theme");
  localStorage.setItem("theme", isDark ? "dark" : "light");
  themeToggle.textContent = isDark ? "‚òÄÔ∏è Theme" : "üåô Theme";
});

// Hamburger toggle
const hamburger = document.querySelector('.tm-hamburger');
const nav = document.querySelector('.tm-navlinks');
hamburger.addEventListener('click', () => nav.classList.toggle('show-links'));
window.addEventListener('resize', () => { if(window.innerWidth>768) nav.classList.remove('show-links'); });

// Pick-a-Peace Logic
const moods = [
  { mood:"happy", color:"var(--happy)", quotes:[
    "Joy is contagious ‚Äî spread it!",
    "Gratitude turns what we have into enough.",
    "The happiest people don't have the best of everything, they make the best of everything.",
    "Your smile can light up someone‚Äôs darkest day."
  ]},
  { mood:"sad", color:"var(--sad)", quotes:[
    "Healing takes time ‚Äî be gentle with yourself.",
    "It's okay to feel, to cry, to pause.",
    "Your emotions are valid ‚Äî honor them.",
    "Even the darkest night ends with dawn."
  ]},
  { mood:"angry", color:"var(--angry)", quotes:[
    "Let go of anger to let in peace.",
    "Pause. Breathe. Respond, don‚Äôt react.",
    "You are not your anger.",
    "Anger is a signal, not a sentence."
  ]},
  { mood:"calm", color:"var(--calm)", quotes:[
    "Inhale peace, exhale tension.",
    "Calmness is the cradle of power.",
    "Stillness speaks louder than noise.",
    "Let peace flow like a river within you."
  ]}
];
let usedQuotes = JSON.parse(localStorage.getItem("usedQuotes")) || [];

function getUniqueQuote(mood) {
  const available = mood.quotes.filter(q => !usedQuotes.includes(q));
  if (available.length === 0) {
    usedQuotes = [];
    localStorage.setItem("usedQuotes", JSON.stringify(usedQuotes));
    return getUniqueQuote(mood);
  }
  const quote = available[Math.floor(Math.random() * available.length)];
  usedQuotes.push(quote);
  localStorage.setItem("usedQuotes", JSON.stringify(usedQuotes));
  return quote;
}

function speak(text) {
  const synth = window.speechSynthesis;
  const utter = new SpeechSynthesisUtterance(text);
  utter.pitch = 1;
  utter.rate = 0.9;
  synth.cancel();
  synth.speak(utter);
}

function createChits() {
  const bowl = document.getElementById('bowl');
  bowl.innerHTML = '';
  let chits = [];

  for (let i = 0; i < 40; i++) {
    const mood = moods[i % moods.length];
    const chit = document.createElement('div');
    chit.className = 'chit';
    chit.style.background = mood.color;
    chit.style.setProperty('--rand', Math.random());
    chit.innerText = "‚ú®";

    chit.onclick = function () {
      const quote = getUniqueQuote(mood);
      const popup = document.createElement('div');
      popup.className = 'popup';
      popup.style.borderLeft = `5px solid ${mood.color}`;
      popup.innerHTML = `
        <span class='close-btn' onclick='this.parentElement.remove()'>&times;</span>
        <p>${quote}</p>
        <button onclick="speak('${quote.replace(/'/g,"\\'")}')">üîä Hear it</button>
        <button onclick="saveQuote('${quote.replace(/'/g,"\\'")}')">üìå Save</button>
      `;
      document.body.appendChild(popup);
    };

    chits.push(chit);
  }

  chits.sort(() => Math.random() - 0.5).forEach(c => bowl.appendChild(c));
}

function shuffleChits(btn) {
  const bowl = document.getElementById('bowl');
  bowl.classList.add("shake");
  btn.textContent = 'üîÑ Shuffling...';
  setTimeout(() => {
    bowl.classList.remove("shake");
    createChits();
    btn.textContent = 'üîÑ Shuffle Chits';
  }, 700);
}

function saveQuote(quote) {
  let saved = JSON.parse(localStorage.getItem("savedQuotes")) || [];
  if (!saved.includes(quote)) {
    saved.push(quote);
    localStorage.setItem("savedQuotes", JSON.stringify(saved));
    alert("‚úÖ Saved!");
  }
}

function toggleSaved() {
  const panel = document.getElementById("savedPanel");
  const list = document.getElementById("savedList");
  list.innerHTML = '';
  let saved = JSON.parse(localStorage.getItem("savedQuotes")) || [];

  saved.forEach(q => {
    const item = document.createElement("div");
    item.className = "saved-item";
    item.innerText = q;

    const delBtn = document.createElement("button");
    delBtn.innerHTML = "‚ùå";
    delBtn.onclick = () => {
      saved = saved.filter(s => s !== q);
      localStorage.setItem("savedQuotes", JSON.stringify(saved));
      toggleSaved(); // Refresh panel
    };
    item.appendChild(delBtn);
    list.appendChild(item);
  });

  panel.classList.toggle("active");
}

// Initialize chits on page load
window.onload = createChits;
</script>
</body>
</html>

