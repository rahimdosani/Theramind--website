<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pick-a-Peace | Theramind</title>
  <link rel="icon" href="https://img.icons8.com/ios-filled/50/peace.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />

  <style>
    /* ===================== Theme Variables ===================== */
    :root {
      --background: #ffffff;
      --foreground: #111111;
      --primary: #4f46e5;
      --accent: #06b6d4;
      --sidebar-bg: rgba(255,255,255,0.85);
      --glass-blur: blur(16px) saturate(180%);
      --button-color: #ffffff;
      --happy: #ffe44c;
      --sad: #8ac0f2;
      --angry: #ff5e5e;
      --calm: #90ee90;
    }
    body.dark-theme {
      --background: #0d0d0f;
      --foreground: #f0f0f0;
      --primary: #6366f1;
      --accent: #67e8f9;
      --sidebar-bg: rgba(30,30,30,0.85);
    }

    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      font-family: 'Poppins', sans-serif;
      background: var(--background);
      color: var(--foreground);
      display:flex; flex-direction:column;
      min-height:100vh; overflow-x:hidden;
      transition: background 0.3s, color 0.3s;
    }

    /* ===================== Navbar ===================== */
    .tm-nav {
      display:flex;
      align-items:center;
      justify-content:space-between;
      height:75px;
      padding:0 2rem;
      background: var(--sidebar-bg);
      backdrop-filter: var(--glass-blur);
      box-shadow: 0 6px 25px rgba(0,0,0,0.15);
      position: sticky;
      top:0;
      z-index: 100;
    }
    .tm-brand {
      display:flex;
      align-items:center;
      gap:0.75rem;
      font-weight:700;
      font-size:1.4rem;
      color: var(--foreground);
      text-decoration:none;
    }
    .tm-brand img { height:36px; }
    .tm-navlinks {
      display:flex;
      gap:1.5rem;
      align-items:center;
      flex-wrap:wrap;
    }
    .tm-navlinks a {
      text-decoration:none;
      font-weight:600;
      color: var(--primary);
      position: relative;
      transition: color 0.3s;
    }
    .tm-navlinks a:hover { color: var(--accent); }
    .tm-navlinks a.active::after {
      content:'';
      position:absolute;
      bottom:-6px;
      left:0;
      width:100%;
      height:3px;
      background: var(--primary);
      border-radius:4px;
    }
    .theme-toggle {
      cursor:pointer;
      font-size:0.9rem;
      background: linear-gradient(135deg,var(--primary),var(--accent));
      padding:6px 10px;
      border-radius:6px;
      color: var(--button-color);
      transition:0.3s;
    }
    .theme-toggle:hover { opacity:0.85; }
    @media (max-width:768px){
      .tm-nav { flex-direction:column; align-items:flex-start; height:auto; padding:1rem; }
      .tm-navlinks { flex-direction:column; align-items:flex-start; width:100%; gap:0.6rem; margin-top:0.5rem; }
      .theme-toggle { align-self:flex-start; margin-top:0.5rem; }
    }

    /* ===================== Pick-a-Peace Styles ===================== */
    main { flex:1; padding:40px 20px; display:flex; flex-direction:column; align-items:center; position:relative; }
    #particles-js { position:absolute; top:0; left:0; width:100%; height:100%; z-index:0; }
    h1 { font-size:2.8rem; font-weight:600; margin-bottom:10px; z-index:2; }
    .subtitle { font-size:1.15rem; color: #666; margin-bottom:30px; z-index:2; }

    .bowl-container {
      position:relative; width:100%; max-width:1000px; height:420px;
      background: radial-gradient(circle at 50% 40%, #ffffffa0, #c7d2fe);
      border-radius: 50% / 35%; border: 5px solid #ffffff88;
      box-shadow: inset 0 8px 25px rgba(0,0,0,0.15);
      overflow:hidden; z-index:2;
      display:flex; flex-wrap:wrap; justify-content:center; align-items:center;
      padding:30px; gap:16px;
      transition: transform 0.4s ease;
    }
    .bowl-container.shake { transform: rotate(2deg); }
    .chit {
      width:70px; height:40px;
      border-radius:6px; box-shadow:0 4px 10px rgba(0,0,0,0.25);
      cursor:pointer; transition: transform 0.25s ease, box-shadow 0.25s ease;
      display:flex; justify-content:center; align-items:center;
      font-size:0.8rem; font-weight:600; color:#222;
      transform: rotate(calc(-15deg + 30deg * var(--rand, 0.5)));
    }
    .chit:hover { transform: scale(1.15) rotate(0deg); z-index:3; box-shadow:0 6px 14px rgba(0,0,0,0.35); }

    .popup {
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.8);
      background: var(--sidebar-bg); backdrop-filter: var(--glass-blur);
      padding: 25px 30px; border-radius: 16px;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.25);
      text-align:center; font-size:1.15rem; z-index:999;
      animation: popin 0.3s ease forwards;
      max-width:400px; color:var(--foreground);
    }
    .popup p { margin-bottom:15px; line-height:1.4; }
    .popup .close-btn { position:absolute; top:10px; right:16px; font-size:22px; cursor:pointer; }
    .popup button {
      margin-top:10px; padding:8px 18px; border:none; border-radius:8px;
      background: var(--primary); color:white; font-weight:600; cursor:pointer;
    }
    @keyframes popin { to { transform: translate(-50%, -50%) scale(1); } }

    .shuffle-btn, .saved-btn {
      margin:25px 10px 0; padding:12px 26px; font-size:1rem;
      background: var(--primary); color:white; border:none;
      border-radius:12px; cursor:pointer; z-index:2;
    }

    .legend { display:flex; gap:24px; margin-top:16px; flex-wrap:wrap; justify-content:center; z-index:2; }
    .legend-item { display:flex; align-items:center; gap:8px; font-size:0.9rem; }
    .legend-item span { width:18px; height:18px; border-radius:50%; display:inline-block; }

    .saved-panel {
      position: fixed; top:50%; left:50%; transform:translate(-50%, -50%) scale(0.8);
      background: var(--sidebar-bg); border-radius:14px; padding:20px;
      box-shadow:0 8px 28px rgba(0,0,0,0.25);
      width:350px; max-height:60vh; overflow-y:auto; z-index:999; display:none;
      color:var(--foreground); backdrop-filter:var(--glass-blur);
    }
    .saved-panel.active { display:block; animation:popin 0.3s ease forwards; }
    .saved-item { background:#f3f3f3; padding:8px 10px; border-radius:8px; margin-bottom:10px; font-size:0.9rem; position:relative; }
    .saved-item button { position:absolute; right:8px; top:6px; background:none; border:none; cursor:pointer; font-size:14px; }
  </style>
</head>
<body>
  <!-- ‚úÖ Universal Navbar -->
  <header class="tm-nav">
    <a class="tm-brand" href="/home">
      <img src="https://img.icons8.com/fluency/48/brain.png" alt="Theramind Logo">
      <span>Theramind</span>
    </a>
    <nav class="tm-navlinks">
      <a href="/home">üè† Home</a>
      <a href="/index">üí¨ Chat</a>
      <a href="/journaling">üìì Journal</a>
      <a href="/breathing">ü´Å Breathing</a>
      <a href="/pick-a-peace" class="active">üìÉ Pick-a-Peace</a>
      <a href="/calm-corner">üßò Calm Corner</a>
      <a href="/ebooks">üìö E-Books</a>
      <a href="/history">üï∞Ô∏è History</a>
    </nav>
    <div class="theme-toggle" id="themeToggle" onclick="toggleTheme()">üåì Theme</div>
  </header>

  <div id="particles-js"></div>
  <main>
    <h1>Pick-a-Peace</h1>
    <p class="subtitle">Pick a chit from the bowl and reveal a thoughtful quote.</p>
    <div class="bowl-container" id="bowl"></div>
    <div>
      <button class="shuffle-btn" onclick="shuffleChits(this)">üîÑ Shuffle Chits</button>
      <button class="saved-btn" onclick="toggleSaved()">üìå Saved Quotes</button>
    </div>
    <div class="legend">
      <div class="legend-item"><span style="background: var(--happy);"></span> Happy</div>
      <div class="legend-item"><span style="background: var(--sad);"></span> Sad</div>
      <div class="legend-item"><span style="background: var(--angry);"></span> Angry</div>
      <div class="legend-item"><span style="background: var(--calm);"></span> Calm</div>
    </div>
  </main>

  <div class="saved-panel" id="savedPanel">
    <h3>Saved Quotes</h3>
    <div id="savedList"></div>
    <button onclick="toggleSaved()">Close</button>
  </div>

  <script>
    // === Navbar Theme Toggle with Persistence ===
    document.addEventListener("DOMContentLoaded", () => {
      const currentPath = window.location.pathname;
      document.querySelectorAll(".tm-navlinks a").forEach(link => {
        if (currentPath.includes(link.getAttribute("href"))) {
          link.classList.add("active");
        }
      });
      const themeToggle = document.getElementById("themeToggle");
      const prefersDark = localStorage.getItem("theme") === "dark";
      if (prefersDark) {
        document.body.classList.add("dark-theme");
        themeToggle.textContent = "‚òÄÔ∏è Theme";
      } else {
        themeToggle.textContent = "üåô Theme";
      }
    });
    function toggleTheme() {
      const themeToggle = document.getElementById("themeToggle");
      document.body.classList.toggle("dark-theme");
      const isDark = document.body.classList.contains("dark-theme");
      localStorage.setItem("theme", isDark ? "dark" : "light");
      themeToggle.textContent = isDark ? "‚òÄÔ∏è Theme" : "üåô Theme";
    }

    // === Pick-a-Peace Logic ===
    const moods = [
      { mood:"happy", color:"var(--happy)", quotes:[
        "Joy is contagious ‚Äî spread it!",
        "Gratitude turns what we have into enough.",
        "The happiest people don't have the best of everything, they make the best of everything.",
        "Your smile can light up someone‚Äôs darkest day."
      ]},
      { mood:"sad", color:"var(--sad)", quotes:[
        "Healing takes time ‚Äî be gentle with yourself.",
        "It's okay to feel, to cry, to pause.",
        "Your emotions are valid ‚Äî honor them.",
        "Even the darkest night ends with dawn."
      ]},
      { mood:"angry", color:"var(--angry)", quotes:[
        "Let go of anger to let in peace.",
        "Pause. Breathe. Respond, don‚Äôt react.",
        "You are not your anger.",
        "Anger is a signal, not a sentence."
      ]},
      { mood:"calm", color:"var(--calm)", quotes:[
        "Inhale peace, exhale tension.",
        "Calmness is the cradle of power.",
        "Stillness speaks louder than noise.",
        "Let peace flow like a river within you."
      ]},
    ];

    let usedQuotes = JSON.parse(localStorage.getItem("usedQuotes")) || [];
    function getUniqueQuote(mood) {
      const available = mood.quotes.filter(q => !usedQuotes.includes(q));
      if (available.length === 0) {
        usedQuotes = [];
        localStorage.setItem("usedQuotes", JSON.stringify(usedQuotes));
        return getUniqueQuote(mood);
      }
      const quote = available[Math.floor(Math.random() * available.length)];
      usedQuotes.push(quote);
      localStorage.setItem("usedQuotes", JSON.stringify(usedQuotes));
      return quote;
    }

    function speak(text) {
      const synth = window.speechSynthesis;
      const utter = new SpeechSynthesisUtterance(text);
      utter.pitch=1; utter.rate=0.9;
      synth.cancel(); synth.speak(utter);
    }

    function createChits() {
      const bowl = document.getElementById('bowl');
      bowl.innerHTML='';
      let chits=[];
      for (let i=0; i<40; i++) {
        const mood = moods[i % moods.length];
        const chit = document.createElement('div');
        chit.className='chit';
        chit.style.background=mood.color;
        chit.style.setProperty("--rand", Math.random());
        chit.innerText="‚ú®";
        chit.onclick=function(){
          const quote=getUniqueQuote(mood);
          const popup=document.createElement('div');
          popup.className='popup';
          popup.style.borderLeft=`5px solid ${mood.color}`;
          popup.innerHTML=`
            <span class='close-btn' onclick='this.parentElement.remove()'>&times;</span>
            <p>${quote}</p>
            <button onclick="speak('${quote.replace(/'/g,"\\'")}')">üîä Hear it</button>
            <button onclick="saveQuote('${quote.replace(/'/g,"\\'")}')">üìå Save</button>
          `;
          document.body.appendChild(popup);
        };
        chits.push(chit);
      }
      chits.sort(() => Math.random()-0.5).forEach(c=>bowl.appendChild(c));
    }

    function shuffleChits(btn){
      const bowl=document.getElementById('bowl');
      bowl.classList.add("shake");
      btn.textContent='üîÑ Shuffling...';
      setTimeout(()=>{
        bowl.classList.remove("shake");
        createChits();
        btn.textContent='üîÑ Shuffle Chits';
      },700);
    }

    function saveQuote(quote){
      let saved=JSON.parse(localStorage.getItem("savedQuotes"))||[];
      if(!saved.includes(quote)){
        saved.push(quote);
        localStorage.setItem("savedQuotes",JSON.stringify(saved));
        alert("‚úÖ Saved!");
      }
    }

    function toggleSaved(){
      const panel=document.getElementById("savedPanel");
      const list=document.getElementById("savedList");
      list.innerHTML='';
      let saved=JSON.parse(localStorage.getItem("savedQuotes"))||[];
      saved.forEach(q=>{
        const item=document.createElement("div");
        item.className="saved-item";
        item.innerText=q;
        const delBtn=document.createElement("button");
        delBtn.innerHTML="‚ùå";
        delBtn.onclick=()=>{saved=saved.filter(s=>s!==q); localStorage.setItem("savedQuotes",JSON.stringify(saved)); toggleSaved(); toggleSaved();};
        item.appendChild(delBtn);
        list.appendChild(item);
      });
      panel.classList.toggle("active");
    }

    window.onload=createChits;
  </script>

  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <script>
    particlesJS("particles-js", {
      particles: {
        number: { value: 35 },
        color: { value: "#6c63ff" },
        shape: { type: "circle" },
        opacity: { value: 0.15 },
        size: { value: 4 },
        move: { enable: true, speed: 0.8 },
        line_linked: { enable: false }
      }
    });
  </script>
</body>
</html>
