<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Welcome back â€” Theramind</title>

  <!-- Mobile-safe viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='brain.png') }}">

  <!-- Particles -->
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

  <style>
    :root {
      --bg1:#eef2ff;
      --bg2:#f8fafc;
      --card-bg:rgba(255,255,255,.65);
      --border:rgba(255,255,255,.4);
      --text-main:#1e1e2f;
      --text-muted:#6b7280;
      --accent:#4f6df5;
      --accent-soft:rgba(79,109,245,.15);
      --shadow:0 30px 60px rgba(0,0,0,.12);
    }

    body.dark {
      --bg1:#0b0c1a;
      --bg2:#0f1224;
      --card-bg:rgba(20,20,35,.7);
      --border:rgba(255,255,255,.08);
      --text-main:#ffffff;
      --text-muted:#9ca3af;
      --accent:#7f8cff;
      --accent-soft:rgba(127,140,255,.2);
      --shadow:0 30px 60px rgba(0,0,0,.6);
    }

    * { box-sizing:border-box }

    body {
      margin:0;
      min-height:100dvh;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:
        radial-gradient(circle at top,#c7d2fe,transparent 55%),
        linear-gradient(180deg,var(--bg1),var(--bg2));
      color:var(--text-main);
      overflow-x:hidden;
      overflow-y:auto;
      padding:
        env(safe-area-inset-top)
        env(safe-area-inset-right)
        env(safe-area-inset-bottom)
        env(safe-area-inset-left);
    }

    #particles-js {
      position:fixed;
      inset:0;
      z-index:0;
      pointer-events:none;
    }

    .auth-wrap {
      min-height:100dvh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px 16px;
      position:relative;
      z-index:1;
    }

    .card {
      width:100%;
      max-width:380px;
      padding:28px 26px 30px;
      border-radius:22px;
      background:var(--card-bg);
      backdrop-filter:blur(18px);
      border:1px solid var(--border);
      box-shadow:var(--shadow);
      animation:floatIn .8s ease;
    }

    @keyframes floatIn {
      from { opacity:0; transform:translateY(18px); }
      to { opacity:1; transform:translateY(0); }
    }

    .logo {
      display:flex;
      justify-content:center;
      gap:10px;
      margin-bottom:14px;
      font-weight:700;
      font-size:20px;
    }

    .logo img { width:34px }

    h2 {
      text-align:center;
      margin:0;
      font-size:22px;
    }

    .subtitle {
      text-align:center;
      font-size:14px;
      color:var(--text-muted);
      margin:6px 0 22px;
    }

    label {
      display:block;
      margin-top:14px;
      font-size:13px;
      color:var(--text-muted);
    }

    input {
      width:100%;
      padding:12px 14px;
      margin-top:6px;
      border-radius:12px;
      border:1px solid #e5e7eb;
      background:rgba(255,255,255,.9);
      font-size:14px;
      transition:.25s ease;
    }

    body.dark input {
      background:rgba(20,20,35,.85);
      border-color:#2a2a45;
      color:white;
    }

    input:focus {
      outline:none;
      border-color:var(--accent);
      box-shadow:0 0 0 4px var(--accent-soft);
    }

    .password-wrap {
      position:relative;
    }

    .toggle-pass {
      position:absolute;
      right:14px;
      top:50%;
      transform:translateY(-50%);
      font-size:12px;
      color:var(--accent);
      cursor:pointer;
    }

    button {
      width:100%;
      padding:13px;
      margin-top:22px;
      border-radius:999px;
      border:none;
      background:linear-gradient(135deg,#4f6df5,#7f87f3);
      color:white;
      font-weight:600;
      font-size:15px;
      cursor:pointer;
      box-shadow:0 10px 30px rgba(79,109,245,.45);
    }

    .google {
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding:12px;
      border-radius:999px;
      border:1px solid #e5e7eb;
      text-decoration:none;
      color:var(--text-main);
      background:rgba(255,255,255,.85);
      font-weight:600;
      margin-bottom:14px;
    }

    body.dark .google {
      background:rgba(20,20,35,.8);
      border-color:#2a2a45;
    }

    .divider {
      text-align:center;
      font-size:12px;
      color:var(--text-muted);
      margin:14px 0;
    }

    .alt {
      margin-top:18px;
      text-align:center;
      font-size:13px;
      color:var(--text-muted);
    }

    .alt a {
      color:var(--accent);
      font-weight:600;
      text-decoration:none;
    }

    .flash {
      padding:10px;
      border-radius:10px;
      margin-bottom:12px;
      font-size:13px;
    }

    .flash.success { background:#ecfdf5; color:#065f46 }
    .flash.warning { background:#fff7ed; color:#92400e }
    .flash.danger { background:#fff1f2; color:#b91c1c }
  </style>
</head>

<body>
<div id="particles-js"></div>

<main class="auth-wrap">
<div class="card">

  <div class="logo">
    <img src="https://img.icons8.com/fluency/48/brain.png">
    Theramind
  </div>

  <h2>Welcome back</h2>
  <div class="subtitle">Your calm space is waiting for you.</div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% for category, msg in messages %}
      <div class="flash {{ category }}">{{ msg }}</div>
    {% endfor %}
  {% endwith %}

  <a class="google" href="{{ url_for('auth_google') }}">
    Continue with Google
  </a>

  <div class="divider">or sign in with email</div>

  <form method="post" action="{{ url_for('user_login') }}"
        onsubmit="this.querySelector('button').disabled=true">
    <label>Email or username</label>
    <input name="email" autocomplete="username" required>

    <label>Password</label>
    <div class="password-wrap">
      <input id="password" name="password" type="password" required>
      <span class="toggle-pass" onclick="togglePassword()">Show</span>
    </div>

    <button type="submit">Sign in</button>
  </form>

  <div class="alt">
    New to Theramind?
    <a href="{{ url_for('signup') }}">Create an account</a>
  </div>

</div>
</main>

<script>
  const savedTheme = localStorage.getItem("theme");
  if (savedTheme === "dark") document.body.classList.add("dark");

  const isDark = document.body.classList.contains("dark");

  function togglePassword() {
    const input = document.getElementById("password");
    const toggle = document.querySelector(".toggle-pass");
    input.type = input.type === "password" ? "text" : "password";
    toggle.textContent = input.type === "password" ? "Show" : "Hide";
  }

  particlesJS("particles-js", {
    particles:{
      number:{ value:60, density:{ enable:true, value_area:800 }},
      color:{ value:isDark ? "#ffffff" : "#4f6df5" },
      size:{ value:3, random:true },
      opacity:{ value:isDark ? 0.35 : 0.4 },
      line_linked:{
        enable:true,
        distance:140,
        color:isDark ? "#ffffff" : "#4f6df5",
        opacity:isDark ? 0.25 : 0.35,
        width:1
      },
      move:{ enable:true, speed:1.1 }
    },
    interactivity:{
      events:{ onhover:{ enable:false }, onclick:{ enable:false } }
    },
    retina_detect:true
  });
</script>
</body>
</html>
