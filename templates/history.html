    <!DOCTYPE html>
    <html lang="en">
    <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Theramind ‚Äì History</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='history.png') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tsparticles@2.11.1/tsparticles.bundle.min.js"></script>

    <style>
    /* ======================================================
      üåó THEME VARIABLES
    ====================================================== */
    :root {
      --background: #ffffff;
      --foreground: #111111;
      --primary: #4f46e5;
      --accent: #06b6d4;

      --bubble-user: #dbeafe;
      --bubble-bot: #f9fafb;

      --sidebar-bg: rgba(255, 255, 255, 0.85);
      --button-bg: var(--primary);
      --button-color: #ffffff;
      --link-color: var(--primary);

      --glass-blur: blur(16px) saturate(180%);
    }

    body.dark-theme {
      --background: #0d0d0f;
      --foreground: #f0f0f0;
      --primary: #6366f1;
      --accent: #67e8f9;

      --bubble-user: #1e1e1e;
      --bubble-bot: #222222;

      --sidebar-bg: rgba(30,30,30,0.85);
      --button-bg: var(--primary);
      --button-color: #ffffff;
      --link-color: var(--accent);
    }

    /* ======================================================
      üåç BASE
    ====================================================== */
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: var(--background);
      color: var(--foreground);
      transition: background 0.3s ease, color 0.3s ease;
      isolation: isolate; /* IMPORTANT: isolates stacking contexts */
    }

    /* ======================================================
      ‚ú® PARTICLES (FIXED)
    ====================================================== */
    #tsparticles {
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;

      /* Ensures smooth compositing under glass layers */
      will-change: transform, opacity;
    }

    /* ======================================================
      üß≠ NAVBAR (UNTOUCHED)
    ====================================================== */
    .tm-nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 75px;
      padding: 0 2rem;
      background: var(--sidebar-bg);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      box-shadow: 0 6px 25px rgba(0,0,0,0.15);
      position: sticky;
      top: 0;
      z-index: 1001;
    }

    .tm-brand {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 700;
      font-size: 1.4rem;
      color: var(--foreground);
      text-decoration: none;
    }

    .tm-brand img { height:36px; }

    .tm-navlinks {
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
      align-items: center;
    }

    .tm-navlinks a {
      text-decoration: none;
      font-weight: 600;
      color: var(--link-color);
      position: relative;
      transition: color 0.3s;
    }

    .tm-navlinks a:hover { color: var(--accent); }

    .tm-navlinks a.active::after {
      content: '';
      position: absolute;
      bottom: -6px;
      left: 0;
      width: 100%;
      height: 3px;
      background: var(--primary);
      border-radius: 4px;
    }

    .theme-toggle {
      cursor: pointer;
      font-size: 0.9rem;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      padding: 6px 10px;
      border-radius: 6px;
      color: var(--button-color);
      transition: opacity 0.3s;
    }

    .theme-toggle:hover { opacity: 0.85; }

    /* ======================================================
      üìú HISTORY CONTAINER
    ====================================================== */
    .history-container {
      position: relative;
      z-index: 1;
      max-width: 1000px;
      margin: 40px auto;
      padding: 30px;
      background: rgba(255,255,255,0.65);
      border-radius: 20px;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: 0 8px 40px rgba(0,0,0,0.1);
    }

    body.dark-theme .history-container {
      background: rgba(30,30,30,0.55);
    }

    h2 {
      font-size: 1.6rem;
      margin-top: 30px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--primary);
    }

    /* ======================================================
      üìä SUMMARY DASHBOARD
    ====================================================== */
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .summary-card {
      padding: 22px;
      border-radius: 18px;
      background: rgba(255,255,255,0.75);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.08);
      transition: transform 0.25s ease;
    }

    body.dark-theme .summary-card {
      background: rgba(35,35,45,0.6);
    }

    .summary-card:hover {
      transform: translateY(-4px);
    }

    .summary-title {
      font-weight: 600;
      font-size: 0.95rem;
      opacity: 0.85;
    }

    .summary-sub {
      font-size: 0.85rem;
      opacity: 0.75;
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    /* Accent borders */
    .summary-card.primary { border-left: 5px solid var(--primary); }
    .summary-card.accent  { border-left: 5px solid var(--accent); }
    .summary-card.calm    { border-left: 5px solid #22c55e; }

    /* ======================================================
      üîò WEEKLY / MONTHLY TOGGLE
    ====================================================== */
    .range-toggle {
      border: none;
      background: transparent;
      color: var(--foreground);
      font-size: 0.75rem;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 6px;
      cursor: pointer;
      opacity: 0.6;
    }

    .range-toggle.active {
      background: var(--primary);
      color: #ffffff;
      opacity: 1;
    }

    .range-toggle:not(.active):hover {
      opacity: 0.9;
    }

    /* ======================================================
      üü¢ WELLNESS SCORE RING
    ====================================================== */
    .score-ring {
      position: relative;
      width: 96px;
      height: 96px;
      margin: 6px 0;
    }

    .score-ring svg {
      transform: rotate(-90deg);
    }

    .ring-bg {
      fill: none;
      stroke: rgba(0,0,0,0.08);
      stroke-width: 8;
    }

    body.dark-theme .ring-bg {
      stroke: rgba(255,255,255,0.15);
    }

    .ring-progress {
      fill: none;
      stroke: var(--primary);
      stroke-width: 8;
      stroke-linecap: round;
      stroke-dasharray: 264;
      stroke-dashoffset: 264;
      transition: stroke-dashoffset 1s ease, stroke 0.3s ease;
    }

    .ring-text {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      font-weight: 700;
    }

    /* ======================================================
      üéõÔ∏è CONTROLS
    ====================================================== */
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
      align-items: center;
    }

    .controls input,
    .controls select {
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 0.9rem;
    }

    .controls input { flex: 1; }

    .controls button {
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      background: var(--button-bg);
      color: var(--button-color);
      font-weight: 600;
      cursor: pointer;
    }

    .controls button:hover { filter: brightness(0.9); }

    /* ======================================================
      üìù ENTRIES & CARDS
    ====================================================== */
    .entry {
      background: rgba(255,255,255,0.85);
      padding: 18px;
      margin: 16px 0;
      border-left: 5px solid var(--primary);
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
      transition: transform 0.2s ease;
    }

    body.dark-theme .entry {
      background: rgba(50,50,50,0.5);
    }

    .entry:hover { transform: translateY(-2px); }

    .entry strong { display: block; margin-bottom: 6px; }
    .entry small  { display: block; opacity: 0.7; margin-bottom: 4px; }

    .empty-state {
      text-align: center;
      color: #888;
      margin-top: 20px;
      font-style: italic;
    }

    /* ======================================================
      üí¨ SAVED CHATS
    ====================================================== */
    .saved-chat-card {
      background: rgba(255,255,255,0.85);
      padding: 14px 16px;
      margin: 12px 0;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    body.dark-theme .saved-chat-card {
      background: rgba(50,50,50,0.5);
    }

    .saved-chat-title { font-weight: 600; }
    .saved-chat-meta  { font-size: 0.8rem; opacity: 0.7; }

    /* ======================================================
      üìà CHARTS
    ====================================================== */
    .chart-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 30px;
      margin-top: 20px;
    }

    #chartWrapper {
      flex: 2;
      min-width: 250px;
      min-height: 220px;
    }

    .pie-wrapper {
      flex: 1;
      min-width: 250px;
      max-width: 350px;
    }

    canvas {
      width: 100% !important;
      height: auto !important;
    }

    /* ======================================================
      üì± RESPONSIVE
    ====================================================== */
    @media (max-width: 1024px) {
      .history-container { max-width: 90%; padding: 25px; }
      h2 { font-size: 1.4rem; }
    }

    @media (max-width: 768px) {
      .controls { flex-direction: column; }
      .chart-container { flex-direction: column; }
      .entry { font-size: 0.9rem; }
    }

    @media (max-width: 480px) {
      h2 { font-size: 1.2rem; }
      .entry { font-size: 0.85rem; }
    }
    @media (max-width: 480px) {
      .history-container {
        margin-top: 80px;
        padding: 20px;
      }
    }
    /* ===================== Mobile Sidebar ===================== */
    .tm-sidebar {
      background: var(--sidebar-bg);
      backdrop-filter: var(--glass-blur);
      width: 260px;
      padding: 1.5rem 1.2rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      box-shadow: 4px 0 20px rgba(0,0,0,0.2);
      border-radius: 0 14px 14px 0;
      transform: translateX(-100%);
    }

    .sidebar-nav {
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }

    .sidebar-nav a {
      text-decoration: none;
      font-weight: 600;
      padding: 0.6rem 0.9rem;
      border-radius: 10px;
      color: var(--foreground);
    }

    .sidebar-nav a.active {
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: #fff;
    }

    .icon-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: var(--button-color);
      border: none;
      border-radius: 12px;
      padding: 0.5rem 0.7rem;
      cursor: pointer;
    }

    .mobile-only { display: none; }

    @media (max-width: 1024px) {
      .mobile-only { display: inline-flex; }
      .tm-navlinks { display: none !important; }

      .tm-sidebar {
        position: fixed;
        top: 75px;
        left: 0;
        height: calc(100dvh - 75px);
        z-index: 200;
      }

      .tm-sidebar.show {
        transform: translateX(0);
      }

      body.sidebar-open {
        overflow: hidden;
      }
    }

    @media (min-width: 1025px) {
      .tm-sidebar {
        display: none !important;
      }
    }

    </style>


    </head>
    <body>
      <!-- ===================== PARTICLES ===================== -->
      <div id="tsparticles" aria-hidden="true"></div>

      <!-- ===================== NAVBAR ===================== -->
      <header class="tm-nav" role="banner">
        <a class="tm-brand" href="/" aria-label="Theramind Home">
          <img src="https://img.icons8.com/fluency/48/brain.png" alt="Theramind Logo">
          <span>Theramind</span>
        </a>

      

        <nav class="tm-navlinks" role="navigation" aria-label="Primary">
          <a href="/">üè† Home</a>
          <a href="/index">üí¨ Chat</a>
          <a href="/journaling">üìì Journal</a>
          <a href="/breathing">ü´Å Breathing</a>
          <a href="/pick-a-peace">üìÉ Pick-a-Peace</a>
          <a href="/calm-corner">üßò Calm Corner</a>
          <a href="/ebooks">üìö E-Books</a>
          <a href="/history" class="active" aria-current="page">üï∞Ô∏è History</a>
        </nav>

        <div class="theme-toggle" id="themeToggle" role="button" aria-label="Toggle theme">
          üåô Theme
        </div>
        <button
      id="sidebarToggle"
      class="icon-btn mobile-only"
      aria-label="Toggle sidebar"
      aria-expanded="false"
      aria-controls="sidebar"
    >
      ‚ò∞
    </button>
      </header>
      <aside id="sidebar" class="tm-sidebar" aria-label="Sidebar Navigation">
      <nav class="sidebar-nav mobile-only">
        <a href="/">üè† Home</a>
        <a href="/index">üí¨ Chat</a>
        <a href="/journaling">üìì Journal</a>
        <a href="/breathing">ü´Å Breathing</a>
        <a href="/pick-a-peace">üìÉ Pick-a-Peace</a>
        <a href="/calm-corner">üßò Calm Corner</a>
        <a href="/ebooks">üìö E-Books</a>
        <a href="/history" class="active">üï∞Ô∏è History</a>
      </nav>
    </aside>

      <!-- ===================== HISTORY DASHBOARD ===================== -->
      <main class="history-container" role="main" aria-busy="true">

        <!-- ===================== SUMMARY DASHBOARD ===================== -->
        <section class="summary-grid" aria-label="Wellness Summary">

          <!-- ===== WELLNESS SCORE ===== -->
          <div class="summary-card primary">
            <div class="summary-title">üìä Wellness Score</div>

            <div class="score-ring" aria-hidden="true">
              <svg width="96" height="96">
                <circle cx="48" cy="48" r="42" class="ring-bg"></circle>
                <circle cx="48" cy="48" r="42" class="ring-progress"></circle>
              </svg>
              <div class="ring-text" id="wellnessScore">--</div>
            </div>

            <div class="summary-sub" role="group" aria-label="Wellness range">
              <button class="range-toggle active" data-range="7" aria-pressed="true">
                Weekly
              </button>
              <button class="range-toggle" data-range="30" aria-pressed="false">
                Monthly
              </button>
            </div>
          </div>

          <!-- ===== BREATHING ===== -->
          <div class="summary-card accent">
            <div class="summary-title">ü´Å Breathing</div>
            <div class="summary-value" id="breathingCount">0</div>
            <div class="summary-sub">
              üî• <span id="breathingStreak">0</span>-day streak
            </div>
          </div>

          <!-- ===== TIME BALANCE ===== -->
          <div class="summary-card calm">
            <div class="summary-title">‚è±Ô∏è Time Balance</div>
            <div class="summary-value">
              <span id="journalMinutes">0</span>m /
              <span id="chatMinutes">0</span>m
            </div>
            <div class="summary-sub">Journal vs Chat</div>
          </div>

        </section>

        <!-- ===================== FILTER CONTROLS ===================== -->
        <section class="controls" aria-label="History Filters">
          <input
            type="text"
            id="searchJournal"
            placeholder="Search journal entries (text, tags, mood)..."
            aria-label="Search journal entries"
          />

          <select id="dateRange" aria-label="Select date range">
            <option value="all">All time</option>
            <option value="7">Last 7 days</option>
            <option value="30">Last 30 days</option>
            <option value="90">Last 90 days</option>
          </select>

          <button id="exportJournal">Export Journal</button>
          <button id="exportChat">Export Chat History</button>
        </section>

        <!-- ===================== MOOD OVERVIEW ===================== -->
        <section aria-label="Mood Overview">
          <h2>üìä Mood Overview</h2>
          <div class="chart-container">
            <div class="chart-wrapper">
              <canvas id="moodLineChart"></canvas>
            </div>
            <div class="pie-wrapper">
              <canvas id="moodPieChart"></canvas>
            </div>
          </div>
          <div id="moodEntries"></div>
        </section>

        <!-- ===================== ANXIETY TREND ===================== -->
        <section aria-label="Anxiety Trend">
          <h2>üìâ Anxiety Reduction Over Time</h2>
          <div class="chart-container">
            <div class="chart-wrapper">
              <canvas id="anxietyChart"></canvas>
            </div>
          </div>
        </section>

        <!-- ===================== JOURNAL ENTRIES ===================== -->
        <section aria-label="Journal Entries">
          <h2>üìî Journal Entries</h2>
          <div id="journalEntries"></div>
        </section>

        <!-- ===================== SAVED CHATS ===================== -->
        <section aria-label="Saved Chats">
          <h2>üí¨ Saved Chats</h2>
          <div id="savedChats"></div>
        </section>

      </main>
    <script>
  document.addEventListener("DOMContentLoaded", () => {

    /* ===================== THEME ===================== */
    const themeToggle = document.getElementById("themeToggle");
    if (localStorage.getItem("theme") === "dark") {
      document.body.classList.add("dark-theme");
      themeToggle.textContent = "‚òÄÔ∏è Theme";
    }

    themeToggle.addEventListener("click", () => {
      document.body.classList.toggle("dark-theme");
      const isDark = document.body.classList.contains("dark-theme");
      localStorage.setItem("theme", isDark ? "dark" : "light");
      themeToggle.textContent = isDark ? "‚òÄÔ∏è Theme" : "üåô Theme";
      redrawVisuals();
    });

    /* ===================== PARTICLES ===================== */
    let particlesInstance = null;

    async function loadParticles() {
      if (window.matchMedia("(prefers-reduced-motion: reduce)").matches) return;

      const primaryColor = getComputedStyle(document.body)
        .getPropertyValue("--primary")
        .trim();

      if (particlesInstance) await particlesInstance.destroy();

      particlesInstance = await tsParticles.load("tsparticles", {
        fullScreen: { enable: true, zIndex: 0 },
        particles: {
          number: { value: window.innerWidth < 768 ? 30 : 45 },
          color: { value: primaryColor },
          opacity: { value: 0.35 },
          size: { value: { min: 1, max: 2 } },
          move: { enable: true, speed: 0.6 },
          links: { enable: true, distance: 120, opacity: 0.35 }
        }
      });
    }

    loadParticles();

    /* ===================== STATE ===================== */
    let journalDataRaw = [];
    let filteredJournalData = [];
    let chatCount = 0;

    const searchInput = document.getElementById("searchJournal");
    const dateRangeSelect = document.getElementById("dateRange");

    const parseEntryDate = e => e.date ? new Date(e.date) : null;

    /* ===================== FETCH JOURNALS ===================== */
    fetch("/api/history/journals")
      .then(r => r.json())
      .then(data => {
        journalDataRaw = data.map(e => ({
          date: e.date,
          entry: e.entry,
          mood: e.mood || null,
          tags: e.tags || ""
        }));
        filteredJournalData = journalDataRaw.slice();
        applyFilters();
      })
      .catch(() => {
        journalDataRaw = [];
        filteredJournalData = [];
        applyFilters();
      });

    /* ===================== FILTERING ===================== */
    function filterByDateRange(data) {
      const val = dateRangeSelect.value;
      if (val === "all") return data.slice();
      const cutoff = new Date(Date.now() - parseInt(val) * 86400000);
      return data.filter(e => !parseEntryDate(e) || parseEntryDate(e) >= cutoff);
    }

    function applyFilters() {
      filteredJournalData = filterByDateRange(journalDataRaw);
      renderMoodEntries();
      renderJournalEntries(searchInput.value);
      buildCharts();
      buildAnxietyChart(filteredJournalData);
      renderSummary();
    }

    searchInput.addEventListener("input", () =>
      renderJournalEntries(searchInput.value)
    );
    dateRangeSelect.addEventListener("change", applyFilters);

    /* ===================== MOOD ENTRIES ===================== */
    const moodEntriesDiv = document.getElementById("moodEntries");

    function renderMoodEntries() {
      moodEntriesDiv.innerHTML = "";
      const moods = filteredJournalData.filter(e => e.mood).slice(-5).reverse();

      if (!moods.length) {
        moodEntriesDiv.innerHTML = `<p class="empty-state">No mood data found.</p>`;
        return;
      }

      moods.forEach(e => {
        moodEntriesDiv.innerHTML += `
          <div class="entry">
            <small>${e.date || ""}</small>
            <strong>${e.mood}</strong>
            <div>${e.entry || ""}</div>
          </div>`;
      });
    }

    /* ===================== JOURNAL ENTRIES ===================== */
    const journalEntriesDiv = document.getElementById("journalEntries");

    function renderJournalEntries(query = "") {
      journalEntriesDiv.innerHTML = "";
      const q = query.toLowerCase();

      const entries = filteredJournalData.filter(e =>
        [e.entry, e.tags, e.mood].join(" ").toLowerCase().includes(q)
      );

      if (!entries.length) {
        journalEntriesDiv.innerHTML = `<p class="empty-state">No entries found.</p>`;
        return;
      }

      entries.forEach(e => {
        journalEntriesDiv.innerHTML += `
          <div class="entry">
            <small>${e.date || ""}</small>
            ${e.mood ? `<strong>${e.mood}</strong>` : ""}
            <div>${e.entry || ""}</div>
          </div>`;
      });
    }

    /* ===================== CHARTS ===================== */
    const moodScoreMap = {
      "üòÉ Happy": 5, "üòå Calm": 4,
      "üòî Sad": 2, "üò® Anxious": 2,
      "üò† Angry": 1, "üòµ Overwhelmed": 1
    };

    let moodLineChart, moodPieChart, anxietyChart;

    function buildCharts() {
      moodLineChart?.destroy();
      moodPieChart?.destroy();

      const moods = filteredJournalData.filter(e => e.mood);
      if (!moods.length) return;

      moodLineChart = new Chart(
        document.getElementById("moodLineChart"),
        {
          type: "line",
          data: {
            labels: moods.map(e => e.date),
            datasets: [{
              data: moods.map(e => moodScoreMap[e.mood] || 3),
              borderColor: "#4f46e5",
              fill: true
            }]
          },
          options: { plugins: { legend: { display: false } } }
        }
      );

      const counts = {};
      moods.forEach(e => counts[e.mood] = (counts[e.mood] || 0) + 1);

      moodPieChart = new Chart(
        document.getElementById("moodPieChart"),
        {
          type: "pie",
          data: {
            labels: Object.keys(counts),
            datasets: [{ data: Object.values(counts) }]
          }
        }
      );
    }

    function buildAnxietyChart(entries) {
      anxietyChart?.destroy();
      const weekly = {};

      entries.forEach(e => {
        if (["üò® Anxious", "üòµ Overwhelmed"].includes(e.mood) && e.date) {
          const key = e.date.slice(0,7);
          weekly[key] = (weekly[key] || 0) + 1;
        }
      });

      anxietyChart = new Chart(
        document.getElementById("anxietyChart"),
        {
          type: "line",
          data: {
            labels: Object.keys(weekly),
            datasets: [{
              data: Object.values(weekly),
              borderColor: "#f97316",
              fill: true
            }]
          },
          options: { plugins: { legend: { display: false } } }
        }
      );
    }

    /* ===================== SUMMARY ===================== */
    function calculateWellness(journals, chats) {
      const moods = journals.filter(e => e.mood);
      const avgMood =
        moods.reduce((s,e)=>s+(moodScoreMap[e.mood]||3),0)/(moods.length||1);

      return Math.round(
        (avgMood / 5) * 60 +
        Math.min(journals.length * 2, 25) +
        Math.min(chats * 1.5, 15)
      );
    }

    function renderSummary() {
      const score = calculateWellness(filteredJournalData, chatCount);
      document.getElementById("wellnessScore").textContent = score;
      document.getElementById("breathingCount").textContent = "‚Äî";
      document.getElementById("breathingStreak").textContent = "‚Äî";
    }

    /* ===================== SAVED CHATS ===================== */
    fetch("/get_conversations")
      .then(r => r.json())
      .then(res => {
        const chats = res.chats || [];
        chatCount = chats.length;

        const div = document.getElementById("savedChats");
        if (!chats.length) {
          div.innerHTML = `<p class="empty-state">No saved chats yet.</p>`;
          return;
        }

        div.innerHTML = "";
        chats.forEach(c => {
          div.innerHTML += `
            <div class="saved-chat-card">
              <div class="saved-chat-title">${c.title || "Untitled Chat"}</div>
              <div class="saved-chat-meta">${c.created_at || ""}</div>
            </div>`;
        });

        renderSummary();
      });

    function redrawVisuals() {
      loadParticles();
      buildCharts();
      buildAnxietyChart(filteredJournalData);
      renderSummary();
    }

  });
  </script>
    </body>
    </html>
